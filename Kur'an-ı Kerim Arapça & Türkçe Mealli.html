<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#2c3e50">
    <meta name="msapplication-navbutton-color" content="#2c3e50">
    <meta name="apple-mobile-web-app-title" content="Kur'an-ı Kerim Arapça & Türkçe Mealli">
    <title>Kur'an-ı Kerim Arapça & Türkçe Mealli</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --header-bg-start: #2c3e50;
            --header-bg-end: #1a2530;
            --footer-bg-start: #1a2530;
            --footer-bg-end: #2c3e50;
            --accent-color: #3498db;
            --active-color: #f97316;
            --hover-color: rgba(255, 255, 255, 0.2);
            --drawing-toolbar-bg: rgba(52, 73, 94, 0.95);
            --toolbar-icon-size: 20px;
            --toolbar-height: 45px;
            --main-bg-start: #33799d;
            --main-bg-end: #e8ebb4;
            --selection-color: rgba(52, 152, 219, 0.3);
            --selection-border: #3498db;
            --highlight-color: rgba(255, 255, 0, 0.4);
            --popup-bg: #2a3441;
            --popup-border: #3e4a59;
            --text-primary: #ffffff;
            --text-secondary: #b8c5d1;
            --bookmarks-bg: rgba(52, 73, 94, 0.95);
            --thumbnail-bg: rgba(42, 52, 65, 0.95);
            --thumbnail-hover: rgba(52, 152, 219, 0.2);
            --note-favorite: #ffd700;
            --note-category-work: #e74c3c;
            --note-category-study: #3498db;
            --note-category-personal: #9b59b6;
        }

        /* Theme definitions */
        .theme-default {
            --header-bg-start: #2c3e50;
            --header-bg-end: #1a2530;
            --footer-bg-start: #1a2530;
            --footer-bg-end: #2c3e50;
            --main-bg-start: #33799d;
            --main-bg-end: #e8ebb4;
            --accent-color: #3498db;
        }

        .theme-forest {
            --header-bg-start: #2d5a27;
            --header-bg-end: #1a3515;
            --footer-bg-start: #1a3515;
            --footer-bg-end: #2d5a27;
            --main-bg-start: #4a7c59;
            --main-bg-end: #a7c957;
            --accent-color: #6a994e;
        }

        .theme-sunset {
            --header-bg-start: #c73e1d;
            --header-bg-end: #8b1538;
            --footer-bg-start: #8b1538;
            --footer-bg-end: #c73e1d;
            --main-bg-start: #f18701;
            --main-bg-end: #fcbf49;
            --accent-color: #ee6c4d;
        }

        .theme-ocean {
            --header-bg-start: #03045e;
            --header-bg-end: #001d3d;
            --footer-bg-start: #001d3d;
            --footer-bg-end: #03045e;
            --main-bg-start: #0077b6;
            --main-bg-end: #90e0ef;
            --accent-color: #00b4d8;
        }

        .theme-purple {
            --header-bg-start: #5a189a;
            --header-bg-end: #240046;
            --footer-bg-start: #240046;
            --footer-bg-end: #5a189a;
            --main-bg-start: #7209b7;
            --main-bg-end: #c77dff;
            --accent-color: #9d4edd;
        }

        .theme-dark {
            --header-bg-start: #1a1a1a;
            --header-bg-end: #000000;
            --footer-bg-start: #000000;
            --footer-bg-end: #1a1a1a;
            --main-bg-start: #2c2c2c;
            --main-bg-end: #1a1a1a;
            --accent-color: #4a9eff;
        }

        .theme-golden {
            --header-bg-start: #b8860b;
            --header-bg-end: #8b6914;
            --footer-bg-start: #8b6914;
            --footer-bg-end: #b8860b;
            --main-bg-start: #daa520;
            --main-bg-end: #ffd700;
            --accent-color: #ff8c00;
        }

        .theme-emerald {
            --header-bg-start: #0f5132;
            --header-bg-end: #198754;
            --footer-bg-start: #198754;
            --footer-bg-end: #0f5132;
            --main-bg-start: #20c997;
            --main-bg-end: #d1ecf1;
            --accent-color: #17a2b8;
        }

        .theme-crimson {
            --header-bg-start: #8b0000;
            --header-bg-end: #dc143c;
            --footer-bg-start: #dc143c;
            --footer-bg-end: #8b0000;
            --main-bg-start: #ff1744;
            --main-bg-end: #ffcdd2;
            --accent-color: #e91e63;
        }

        .theme-royal {
            --header-bg-start: #4b0082;
            --header-bg-end: #6a5acd;
            --footer-bg-start: #6a5acd;
            --footer-bg-end: #4b0082;
            --main-bg-start: #9370db;
            --main-bg-end: #e6e6fa;
            --accent-color: #8a2be2;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            height: 100%;
            width: 100%;
            overflow: hidden;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        body {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            position: relative;
            background: linear-gradient(135deg, var(--main-bg-start), var(--main-bg-end));
            transition: background 0.3s ease;
            overflow-x: hidden;
        }

        /* ENHANCED RESPONSIVE HEADER LAYOUT */
        .header {
            background: linear-gradient(to bottom, var(--header-bg-start), var(--header-bg-end));
            color: white;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            min-height: var(--toolbar-height);
            flex-shrink: 0;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 100;
            position: relative;
            transition: all 0.3s ease;
            gap: 12px;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
            flex: 0 0 auto;
            min-width: 0;
        }

        .header-center {
            display: flex;
            align-items: center;
            justify-content: center;
            flex: 1;
            min-width: 0;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 0 0 auto;
            justify-content: flex-end;
            min-width: 0;
        }

        .logo {
            height: 32px;
            width: 32px;
            border-radius: 50%;
            flex-shrink: 0;
            transition: transform 0.2s ease;
            cursor: pointer;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.3);
            background: var(--accent-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            background-image: url('https://a.calameoassets.com/3359034/picture.jpg');
            background-size: cover;
            background-position: center;
        }

        .logo:hover {
            transform: scale(1.1);
        }

        .header-title {
            font-size: 16px;
            font-weight: bold;
            color: var(--accent-color);
            white-space: nowrap;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
            letter-spacing: 1px;
            text-align: center;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .icon-group {
            display: flex;
            gap: 5px;
            align-items: center;
            flex-wrap: nowrap;
            overflow: hidden;
        }

        .icon {
            width: 22px;
            height: 22px;
            cursor: pointer;
            transition: all 0.2s ease;
            flex-shrink: 0;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border-radius: 4px;
            padding: 3px;
        }

        .icon:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.1);
            color: var(--accent-color);
        }

        .icon.active {
            color: var(--active-color);
            background: rgba(249, 115, 22, 0.2);
        }

        /* ENHANCED DRAGGABLE DRAWING TOOLBAR - MOBILE OPTIMIZED */
        .drawing-toolbar {
            position: fixed;
            top: 50px;
            left: 2%;
            width: 96%;
            background: var(--drawing-toolbar-bg);
            border-radius: 12px;
            padding: 8px 12px;
            z-index: 250;
            display: none;
            flex-wrap: wrap;
            gap: 6px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            align-items: center;
            justify-content: flex-start;
            min-height: 55px;
            max-height: 130px;
            overflow-y: auto;
            cursor: default;
            transition: all 0.3s ease;
        }

        .drawing-toolbar.show {
            display: flex;
        }

        .drawing-toolbar.dragging {
            transform: rotate(2deg);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.6);
            z-index: 300;
        }

        .drawing-toolbar::-webkit-scrollbar {
            height: 4px;
        }

        .drawing-toolbar::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
        }

        .drawing-toolbar::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 2px;
        }

        /* MOBILE OPTIMIZED - TOOLBAR APPEARS OVER CONTENT */
        @media (max-width: 768px) {
            .drawing-toolbar {
                top: 42px;
                left: 3px;
                width: 52px;
                height: calc(100vh - 130px);
                flex-direction: column;
                padding: 6px 3px;
                overflow-y: auto;
                overflow-x: hidden;
                border-radius: 10px;
                max-height: none;
                z-index: 260; /* Higher z-index to appear over content */
            }

            /* PDF pages should NOT be affected by toolbar in mobile */
            .main-content.drawing-active {
                padding-left: 0 !important; /* Override any left padding */
                padding-top: 0;
            }

            .pdf-page {
                width: calc(100vw - 10px) !important;
                max-width: calc(100vw - 10px) !important;
                /* Enhanced mobile scrolling optimization */
                -webkit-transform: translate3d(0, 0, 0);
                transform: translate3d(0, 0, 0);
                contain: layout style paint;
                isolation: isolate;
            }

            /* Mobile specific optimizations for smooth scrolling */
            .main-content {
                -webkit-overflow-scrolling: touch !important;
                overscroll-behavior-y: contain;
                scroll-snap-type: y proximity;
                scroll-behavior: smooth;
                transform: translateZ(0);
                -webkit-transform: translateZ(0);
                backface-visibility: hidden;
                -webkit-backface-visibility: hidden;
            }

            .pdf-page {
                scroll-snap-align: start;
                margin-bottom: 10px;
                /* Reduce repaints on mobile */
                will-change: transform;
                contain: layout style paint size;
            }
        }

        /* MOVE HANDLE FOR DRAGGING */
        .toolbar-move-handle {
            width: 28px;
            height: 28px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: move;
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
            transition: all 0.2s ease;
            border: 1px solid rgba(255, 255, 255, 0.2);
            margin-right: 6px;
        }

        .toolbar-move-handle:hover {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border-color: rgba(255, 255, 255, 0.4);
            transform: scale(1.1);
        }

        .toolbar-move-handle:active {
            background: var(--accent-color);
            color: white;
        }

        .tool-group {
            display: flex;
            gap: 3px;
            align-items: center;
            padding: 2px 5px;
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.08);
            border-right: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
        }

        .tool-group:last-child {
            border-right: none;
        }

        .tool-group::before {
            content: '';
            position: absolute;
            top: -2px;
            left: 50%;
            transform: translateX(-50%);
            width: 18px;
            height: 1px;
            background: var(--accent-color);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .tool-group:hover::before {
            opacity: 0.7;
        }

        .drawing-tool {
            width: 26px;
            height: 26px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: rgba(255, 255, 255, 0.8);
            border: 1px solid transparent;
            background: rgba(255, 255, 255, 0.05);
            font-size: 11px;
            position: relative;
        }

        .drawing-tool:hover {
            color: white;
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .drawing-tool.active {
            color: var(--active-color);
            border-color: var(--active-color);
            background: linear-gradient(135deg, rgba(249, 115, 22, 0.2), rgba(249, 115, 22, 0.1));
            box-shadow: 0 0 12px rgba(249, 115, 22, 0.3);
        }

        .drawing-tool.active::after {
            content: '';
            position: absolute;
            bottom: -6px;
            left: 50%;
            transform: translateX(-50%);
            width: 5px;
            height: 2px;
            background: var(--active-color);
            border-radius: 1px;
        }

        .color-picker {
            width: 20px;
            height: 20px;
            border-radius: 4px;
            border: 2px solid rgba(255, 255, 255, 0.4);
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }

        .color-picker:hover {
            transform: scale(1.15);
            border-color: white;
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
        }

        .color-picker.active {
            border-color: var(--accent-color);
            box-shadow: 0 0 12px rgba(52, 152, 219, 0.5);
            transform: scale(1.2);
        }

        .color-picker.active::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 9px;
            font-weight: bold;
            text-shadow: 0 0 3px rgba(0, 0, 0, 0.8);
        }

        /* ADVANCED CONTROLS */
        .advanced-controls {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 3px 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .brush-size-group {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 3px 6px;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 6px;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .brush-size-slider {
            width: 55px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        .brush-size-slider::-webkit-slider-thumb {
            appearance: none;
            width: 11px;
            height: 11px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .brush-size-display {
            color: rgba(255, 255, 255, 0.8);
            font-size: 9px;
            min-width: 18px;
            text-align: center;
            font-weight: bold;
        }

        .opacity-slider {
            width: 45px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        .opacity-slider::-webkit-slider-thumb {
            appearance: none;
            width: 11px;
            height: 11px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        /* SELECTION INDICATORS */
        .selection-count {
            color: rgba(255, 255, 255, 0.8);
            font-size: 9px;
            background: rgba(0, 0, 0, 0.5);
            padding: 2px 5px;
            border-radius: 10px;
            position: absolute;
            top: -7px;
            right: -7px;
            min-width: 14px;
            text-align: center;
        }

        /* CUSTOM CURSORS FOR DRAWING TOOLS */
        .cursor-pen { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12 19 7-7 3 3-7 7-3-3z"/><path d="m18 13-1.5-7.5L2 2l3.5 14.5L13 18l5-5z"/><path d="m2 2 7.586 7.586"/><circle cx="11" cy="11" r="2"/></svg>') 12 12, crosshair !important; }

        .cursor-eraser { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 21-4.3-4.3c-1-1-1-2.5 0-3.5l9.6-9.6c1-1 2.5-1 3.5 0l5.2 5.2c1 1 1 2.5 0 3.5L13 21"/><path d="M22 21H7"/><path d="m5 11 9 9"/></svg>') 12 12, crosshair !important; }

        .cursor-hand { cursor: grab !important; }
        .cursor-hand:active { cursor: grabbing !important; }

        .cursor-rectSelect { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"/><path d="M9 9h6v6H9V9z"/></svg>') 12 12, crosshair !important; }

        .cursor-lasso { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="m3 3 2.01 2.01"/><path d="m7 7 2.01 2.01"/></svg>') 12 12, crosshair !important; }

        .cursor-screenshot { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"/><circle cx="12" cy="13" r="3"/></svg>') 12 12, crosshair !important; }

        .cursor-text { cursor: text !important; }

        .cursor-measure { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="7.5 4.21 12 6.81 16.5 4.21"/><polyline points="7.5 19.79 7.5 14.6 3 12"/><polyline points="21 12 16.5 14.6 16.5 19.79"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>') 12 12, crosshair !important; }

        .cursor-numberline { cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="8" x2="3" y2="16"/><line x1="9" y1="10" x2="9" y2="14"/><line x1="15" y1="10" x2="15" y2="14"/><line x1="21" y1="8" x2="21" y2="16"/></svg>') 12 12, crosshair !important; }

        /* POPUP OVERLAY AND CONTENT */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .popup-overlay.hidden {
            display: none;
        }

        .popup-content {
            background: linear-gradient(135deg, var(--popup-bg), #1e2832);
            border-radius: 12px;
            padding: 24px;
            border: 1px solid var(--popup-border);
            max-width: 90%;
            max-height: 80%;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            color: var(--text-primary);
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--popup-border);
        }

        .popup-title {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent-color);
        }

        .popup-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 20px;
            padding: 4px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .popup-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }

        /* URL INPUT POPUP */
        .url-input-popup {
            width: 400px;
            max-width: 90vw;
        }

        .url-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--popup-border);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            font-size: 14px;
            margin-bottom: 16px;
            resize: none;
            font-family: inherit;
            line-height: 1.4;
            word-wrap: break-word;
            white-space: pre-wrap;
            overflow-wrap: break-word;
        }

        .url-input:focus {
            outline: none;
            border-color: var(--accent-color);
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.3);
        }

        .url-input::placeholder {
            color: var(--text-secondary);
        }

        /* Enhanced paste support */
        .url-input::-webkit-input-placeholder {
            color: var(--text-secondary);
        }

        .url-input::-moz-placeholder {
            color: var(--text-secondary);
            opacity: 1;
        }

        .url-input:-ms-input-placeholder {
            color: var(--text-secondary);
        }

        .popup-buttons {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .popup-button {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }

        .popup-button.primary {
            background: var(--accent-color);
            color: white;
        }

        .popup-button.primary:hover {
            background: #2980b9;
        }

        .popup-button.secondary {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            border: 1px solid var(--popup-border);
        }

        .popup-button.secondary:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        /* URL LOADING AND STATUS */
        .url-loading {
            display: flex;
            align-items: center;
            gap: 12px;
            margin: 16px 0;
            padding: 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
        }

        .url-loading.hidden {
            display: none;
        }

        .loading-spinner {
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-top: 2px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        .url-loading-text {
            color: var(--text-primary);
            font-size: 14px;
        }

        .url-progress {
            flex: 1;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
        }

        .url-progress-bar {
            height: 100%;
            background: var(--accent-color);
            border-radius: 2px;
            transition: width 0.3s ease;
            width: 0%;
        }

        .url-status {
            display: flex;
            align-items: center;
            gap: 8px;
            margin: 12px 0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
        }

        .url-status.hidden {
            display: none;
        }

        .url-status.success {
            background: rgba(39, 174, 96, 0.2);
            border: 1px solid rgba(39, 174, 96, 0.3);
            color: #2ecc71;
        }

        .url-status.warning {
            background: rgba(241, 196, 15, 0.2);
            border: 1px solid rgba(241, 196, 15, 0.3);
            color: #f1c40f;
        }

        .url-status.error {
            background: rgba(231, 76, 60, 0.2);
            border: 1px solid rgba(231, 76, 60, 0.3);
            color: #e74c3c;
        }

        .url-status-icon {
            font-size: 14px;
        }

        .url-status-text {
            flex: 1;
        }

        /* RESPONSIVE WELCOME SCREEN */
        .welcome-screen {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 15px;
            background: transparent;
            overflow: hidden;
            width: 100%;
            height: calc(100vh - var(--toolbar-height) * 2);
            min-height: calc(100vh - var(--toolbar-height) * 2);
            max-height: calc(100vh - var(--toolbar-height) * 2);
        }

        .welcome-content {
            background: rgba(0, 0, 0, 0.7);
            padding: 25px;
            border-radius: 16px;
            max-width: 1200px;
            width: 100%;
            height: 100%;
            margin: 0 auto;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            box-shadow: 0 16px 40px rgba(0, 0, 0, 0.4);
            overflow-y: auto;
            max-height: 100%;
        }

        .welcome-title {
            font-size: 2.2rem;
            margin-bottom: 12px;
            background: linear-gradient(45deg, #fff, var(--accent-color), #fff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: bold;
            text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            flex-shrink: 0;
        }

        .welcome-subtitle {
            font-size: 1rem;
            margin-bottom: 20px;
            opacity: 0.9;
            line-height: 1.5;
            flex-shrink: 0;
        }

        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
            flex: 1;
            overflow-y: auto;
            min-height: 200px;
        }

        .feature-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px 15px;
            border-radius: 10px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.3s ease;
            text-align: center;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .feature-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--accent-color), transparent);
            transition: left 0.5s ease;
        }

        .feature-item:hover {
            transform: translateY(-3px);
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .feature-item:hover::before {
            left: 100%;
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--accent-color);
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .feature-title {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 6px;
            color: white;
        }

        .feature-desc {
            font-size: 0.85rem;
            opacity: 0.85;
            line-height: 1.4;
        }

        .start-buttons {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            flex-shrink: 0;
            margin-top: auto;
            padding-top: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
            min-width: 120px;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn-primary {
            background: var(--accent-color);
            color: white;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(52, 152, 219, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .btn-outline {
            background: transparent;
            color: white;
            border: 2px solid var(--accent-color);
        }

        .btn-outline:hover {
            background: var(--accent-color);
            color: white;
            transform: translateY(-2px);
        }

        /* ULTRA HIGH QUALITY PDF Container */
        .main-content {
            flex: 1;
            overflow: auto;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(135deg, var(--main-bg-start), var(--main-bg-end));
            scroll-behavior: smooth;
            position: relative;
            -webkit-overflow-scrolling: touch;
            touch-action: pan-x pan-y pinch-zoom;
            scrollbar-width: none;
            -ms-overflow-style: none;
            padding: 0;
            transition: background 0.3s ease;
            transform: translateZ(0);
            contain: layout style;
            padding-top: 0;
            /* Enhanced mobile scrolling */
            overscroll-behavior: contain;
            -webkit-transform: translate3d(0,0,0);
            -moz-transform: translate3d(0,0,0);
            -ms-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
            will-change: transform;
       scroll-behavior: auto; /* smooth yerine auto */
       transform: translate3d(0,0,0);
       will-change: scroll-position;
        }

        /* REMOVED THE DRAWING-ACTIVE PADDING FOR MOBILE */
        .main-content.drawing-active {
            padding-top: 60px;
        }

        @media (max-width: 768px) {
            .main-content.drawing-active {
                padding-top: 0 !important;
                padding-left: 0 !important;
            }
        }

        .main-content::-webkit-scrollbar {
            display: none;
        }

        /* Drop Zone for Drag & Drop */
        .drop-zone {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(52, 152, 219, 0.9);
            backdrop-filter: blur(10px);
            z-index: 500;
            display: none;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            border: 4px dashed rgba(255, 255, 255, 0.8);
            margin: 20px;
            border-radius: 20px;
        }

        .drop-zone.active {
            display: flex;
        }

        .drop-zone-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
        }

        .drop-zone-icon {
            font-size: 4rem;
            animation: bounce 1s infinite;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }

        .pdf-container {
            display: none;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 8px 0;
            gap: 5px;
            will-change: transform;
            contain: layout style paint;
        }

        .pdf-container.show {
            display: flex;
        }

        .pdf-page {
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            border-radius: 4px;
            position: relative;
            overflow: visible;
            transform-origin: center;
            width: 100%;
            max-width: calc(100vw - 16px);
            min-height: 400px;
            display: flex;
            align-items: center;
            justify-content: center;
            will-change: transform;
            contain: layout style paint;
            transition: box-shadow 0.3s ease;

            /* Mobile optimization for full width display */
            -webkit-transform: translateZ(0);
            transform: translateZ(0);
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .pdf-page:hover {
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .pdf-page img {
            display: block;
            width: 100%;
            height: auto;
            max-width: 100%;
            border-radius: 4px;

            /* Enhanced mobile optimization for smooth scrolling */
            -webkit-transform: translate3d(0, 0, 0);
            transform: translate3d(0, 0, 0);
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            will-change: transform;
            contain: layout style paint;
            -webkit-perspective: 1000px;
            perspective: 1000px;
            /* Optimize for mobile touch scrolling */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .pdf-page .loading-placeholder {
            color: #666;
            font-size: 15px;
            text-align: center;
            padding: 30px;
            cursor: pointer;
            border: 2px dashed #ddd;
            border-radius: 10px;
            background: #f9f9f9;
            transition: all 0.3s ease;
            width: 300px;
        }

        .pdf-page .loading-placeholder:hover {
            background: #f0f0f0;
            border-color: var(--accent-color);
            transform: scale(1.02);
        }

        .pdf-page .retry-btn {
            margin-top: 12px;
            padding: 10px 20px;
            background: var(--accent-color);
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .pdf-page .retry-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        /* ENHANCED Drawing Canvas Overlay */
        .drawing-canvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: none;
            z-index: 10;
            transition: opacity 0.2s ease;
        }

        .drawing-canvas.active {
            pointer-events: auto;
        }

        .drawing-canvas.drawing-mode {
            cursor: crosshair;
        }

        /* ULTRA ENHANCED SELECTION OVERLAY WITH MANIPULATION HANDLES */
        .selection-overlay {
            position: absolute;
            border: 2px dashed var(--selection-border);
            background: var(--selection-color);
            pointer-events: none;
            z-index: 15;
            display: none;
            border-radius: 4px;
            backdrop-filter: blur(2px);
            transition: all 0.3s ease;
        }

        .selection-overlay.show {
            display: block;
        }

        .selection-overlay.active {
            pointer-events: auto;
            cursor: move;
        }

        .selection-overlay.multi-selected {
            border-color: var(--active-color);
            background: rgba(249, 115, 22, 0.2);
        }

        .selection-overlay.manipulating {
            border-color: var(--active-color);
            box-shadow: 0 0 15px rgba(249, 115, 22, 0.5);
            background: rgba(249, 115, 22, 0.1);
        }

        /* ULTRA ENHANCED MANIPULATION HANDLES */
        .manipulation-handle {
            position: absolute;
            width: 12px;
            height: 12px;
            background: var(--accent-color);
            border: 2px solid white;
            cursor: pointer;
            z-index: 16;
            border-radius: 3px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .manipulation-handle:hover {
            background: var(--active-color);
            transform: scale(1.3);
            box-shadow: 0 4px 12px rgba(249, 115, 22, 0.5);
        }

        /* ULTRA ENHANCED MANIPULATION TOOLBAR */
        .manipulation-toolbar {
            position: absolute;
            bottom: -50px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(44, 62, 80, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            gap: 5px;
            padding: 5px;
            z-index: 17;
        }

        .manipulation-tool-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
        }

        .manipulation-tool-btn:hover {
            background: var(--accent-color);
            transform: scale(1.1);
        }

        .manipulation-tool-btn.confirm:hover {
            background: #27ae60;
        }

        .manipulation-tool-btn.cancel:hover {
            background: #c0392b;
        }

        /* ULTRA ENHANCED RESIZE HANDLES */
        .handle-nw { top: -6px; left: -6px; cursor: nw-resize; }
        .handle-ne { top: -6px; right: -6px; cursor: ne-resize; }
        .handle-sw { bottom: -6px; left: -6px; cursor: sw-resize; }
        .handle-se { bottom: -6px; right: -6px; cursor: se-resize; }
        .handle-n { top: -6px; left: calc(50% - 6px); cursor: n-resize; }
        .handle-s { bottom: -6px; left: calc(50% - 6px); cursor: s-resize; }
        .handle-w { top: calc(50% - 6px); left: -6px; cursor: w-resize; }
        .handle-e { top: calc(50% - 6px); right: -6px; cursor: e-resize; }

        /* ULTRA ENHANCED ROTATION HANDLE */
        .handle-rotate {
            top: -25px;
            left: calc(50% - 8px);
            width: 16px;
            height: 16px;
            cursor: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/><path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16"/><path d="M21 21v-5h-5"/></svg>') 12 12, pointer;
            background: var(--active-color);
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }

        .handle-rotate::before {
            content: '↻';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 10px;
            font-weight: bold;
        }

        .handle-rotate::after {
            content: '';
            position: absolute;
            top: 16px;
            left: 6px;
            width: 2px;
            height: 15px;
            background: var(--accent-color);
            border-radius: 1px;
        }

        /* ULTRA ENHANCED MOVE HANDLE */
        .handle-move {
            top: calc(50% - 10px);
            left: calc(50% - 10px);
            width: 20px;
            height: 20px;
            cursor: move;
            background: rgba(52, 152, 219, 0.8);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            color: white;
            border: 2px solid white;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.4);
        }

        .handle-move::before {
            content: '✚';
            font-weight: bold;
            color: white;
        }

        /* Text editing overlay */
        .text-editor {
            position: absolute;
            z-index: 20;
            background: white;
            border: 2px solid var(--accent-color);
            border-radius: 4px;
            padding: 8px;
            min-width: 100px;
            min-height: 30px;
            resize: both;
            overflow: hidden;
        }

        .text-editor textarea {
            border: none;
            outline: none;
            resize: none;
            width: 100%;
            height: 100%;
            font-family: inherit;
            font-size: 14px;
            background: transparent;
        }

   .measurement-point {
       position: absolute;
       background: var(--accent-color);
       border: 2px solid white;
       border-radius: 50%;
       box-shadow: 0 2px 4px rgba(0,0,0,0.3);
       z-index: 20;
   }

        /* Measurement overlay */
        .measurement-line {
            position: absolute;
            background: var(--accent-color);
            height: 2px;
            z-index: 12;
            transform-origin: left center;
        }

        .measurement-label {
            position: absolute;
            background: var(--accent-color);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 12px;
            z-index: 13;
            white-space: nowrap;
        }

        /* Number line overlay */
        .numberline-overlay {
            position: absolute;
            z-index: 12;
            pointer-events: none;
        }

        .numberline-ruler {
            background: var(--accent-color);
            height: 2px;
            position: relative;
        }

        .numberline-tick {
            position: absolute;
            background: var(--accent-color);
            width: 1px;
        }

        .numberline-tick.major {
            height: 20px;
            top: -9px;
        }

        .numberline-tick.minor {
            height: 10px;
            top: -4px;
        }

        .numberline-label {
            position: absolute;
            font-size: 10px;
            color: var(--accent-color);
            top: -25px;
            transform: translateX(-50%);
            font-weight: bold;
        }

        /* Grid overlay */
        .grid-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 5;
            opacity: 0.3;
            background-image:
                linear-gradient(to right, rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(to bottom, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            display: none;
        }

        .grid-overlay.show {
            display: block;
        }

        /* Highlight overlay */
        .highlight-overlay {
            position: absolute;
            background: var(--highlight-color);
            border: 1px solid rgba(255, 255, 0, 0.6);
            border-radius: 2px;
            pointer-events: none;
            z-index: 8;
            opacity: 0.7;
        }

        /* RIGHT CLICK CONTEXT MENU */
        .context-menu {
            position: fixed;
            z-index: 1000;
            background: #2a2a2a;
            border: 1px solid #404040;
            border-radius: 8px;
            padding: 6px 0;
            min-width: 200px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.5);
            display: none;
            backdrop-filter: blur(15px);
        }

        .context-menu-item {
            padding: 12px 20px;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 15px;
            font-size: 14px;
            transition: all 0.2s ease;
            position: relative;
        }

        .context-menu-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: var(--accent-color);
            transform: scaleY(0);
            transition: transform 0.2s ease;
        }

        .context-menu-item:hover {
            background: var(--accent-color);
            padding-left: 25px;
        }

        .context-menu-item:hover::before {
            transform: scaleY(1);
        }

        .context-menu-item.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .context-menu-separator {
            height: 1px;
            background: #404040;
            margin: 6px 0;
        }

        .context-menu-item i {
            width: 18px;
            text-align: center;
            font-size: 14px;
        }

        /* Enhanced Footer */
        .footer {
            background: linear-gradient(to bottom, var(--footer-bg-start), var(--footer-bg-end));
            color: white;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: var(--toolbar-height);
            flex-shrink: 0;
            box-shadow: 0 -2px 5px rgba(0, 0, 0, 0.2);
            z-index: 100;
            position: relative;
            transition: background 0.3s ease;
        }

        .footer-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-center {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .footer-right {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .footer-icon {
            width: 26px;
            height: 26px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border-radius: 6px;
            padding: 5px;
            position: relative;
        }

        .footer-icon:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.1);
        }

        .footer-icon.active {
            background: var(--active-color);
            color: white;
            box-shadow: 0 0 12px rgba(249, 115, 22, 0.4);
        }

        .page-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-icon {
            width: 26px;
            height: 26px;
            cursor: pointer;
            transition: all 0.2s ease;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            border-radius: 6px;
            padding: 5px;
        }

        .page-icon:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.1);
        }

        .page-icon:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .page-input {
            width: 45px;
            padding: 5px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 6px;
            text-align: center;
            font-size: 11px;
            font-weight: bold;
        }

        .page-info {
            color: rgba(255, 255, 255, 0.9);
            font-size: 11px;
            white-space: nowrap;
            font-weight: bold;
        }

        /* Auto Scroll Controls */
        .auto-scroll-container {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border-radius: 30px;
            padding: 12px 25px;
            display: none;
            align-items: center;
            gap: 18px;
            z-index: 200;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            min-width: 320px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .auto-scroll-container.show {
            display: flex;
        }

        .scroll-speed-btn {
            width: 35px;
            height: 35px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .scroll-speed-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .scroll-speed-slider {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        .scroll-speed-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--active-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .scroll-speed-value {
            color: white;
            font-size: 14px;
            font-weight: bold;
            min-width: 45px;
            text-align: center;
        }

        /* Zoom Controls */
        .zoom-container {
            position: fixed;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            border-radius: 30px;
            padding: 12px 25px;
            display: none;
            align-items: center;
            gap: 18px;
            z-index: 200;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
            min-width: 320px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .zoom-container.show {
            display: flex;
        }

        .zoom-btn {
            width: 35px;
            height: 35px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .zoom-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .zoom-slider {
            flex: 1;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            outline: none;
            cursor: pointer;
            appearance: none;
        }

        .zoom-slider::-webkit-slider-thumb {
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent-color);
            border-radius: 50%;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.3);
        }

        .zoom-value {
            color: white;
            font-size: 14px;
            font-weight: bold;
            min-width: 55px;
            text-align: center;
        }

        /* Modal Styles */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            backdrop-filter: blur(8px);
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: var(--popup-bg);
            border: 1px solid var(--popup-border);
            border-radius: 20px;
            padding: 30px;
            width: 90%;
            max-width: 550px;
            max-height: 75vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            position: relative;
        }

        /* Recent Files Modal - GELİŞTİRİLDİ */
        .recent-files-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            backdrop-filter: blur(8px);
        }

        /* Notes Modal */
        .notes-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .notes-modal.show {
            display: flex;
            opacity: 1;
        }

        .notes-container {
            background: linear-gradient(135deg, var(--popup-bg), #1e2832);
            border-radius: 20px;
            padding: 30px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            border: 1px solid var(--popup-border);
            position: relative;
        }

        .notes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
        }

        .notes-title {
            color: white;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .notes-close {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.7);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s ease;
        }

        .notes-close:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: scale(1.1);
        }

        .add-note-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .add-note-input {
            width: 100%;
            min-height: 100px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            padding: 15px;
            color: white;
            font-size: 14px;
            resize: vertical;
            font-family: inherit;
            outline: none;
            transition: all 0.2s ease;
        }

        .add-note-input:focus {
            border-color: var(--accent-color);
            background: rgba(255, 255, 255, 0.15);
            box-shadow: 0 0 10px rgba(52, 152, 219, 0.3);
        }

        .add-note-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .add-note-btn {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            margin-top: 15px;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .add-note-btn:hover {
            background: var(--active-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .notes-list {
            max-height: 400px;
            overflow-y: auto;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) transparent;
        }

        .notes-list::-webkit-scrollbar {
            width: 8px;
        }

        .notes-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .notes-list::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
        }

        .note-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 12px;
            padding: 18px;
            margin-bottom: 15px;
            border-left: 4px solid var(--accent-color);
            transition: all 0.2s ease;
            position: relative;
        }

        .note-favorite-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--note-favorite);
            color: black;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
        }

        .note-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            font-size: 12px;
        }

        .note-category {
            font-weight: bold;
            text-transform: uppercase;
        }

        .note-priority {
            color: var(--note-favorite);
            font-weight: bold;
        }

        .note-item:hover {
            background: rgba(255, 255, 255, 0.12);
            transform: translateX(5px);
        }

        .note-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 12px;
            word-wrap: break-word;
        }

        .note-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
        }

        .note-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .note-pdf, .note-page, .note-date {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .note-delete {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            padding: 6px;
            border-radius: 4px;
            transition: all 0.2s ease;
            font-size: 14px;
        }

        .note-delete:hover {
            background: rgba(220, 53, 69, 0.2);
            color: #dc3545;
            transform: scale(1.1);
        }

        .no-notes {
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            padding: 40px;
            font-size: 16px;
        }

        .no-notes i {
            font-size: 64px;
            margin-bottom: 20px;
            display: block;
            opacity: 0.3;
        }

        .recent-files-modal.show {
            display: flex;
        }

        .recent-files-content {
            background: var(--popup-bg);
            border: 1px solid var(--popup-border);
            border-radius: 20px;
            width: 90%;
            max-width: 550px;
            max-height: 75vh;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            display: flex;
            flex-direction: column;
        }

        .recent-files-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 30px 20px 30px;
            border-bottom: 2px solid var(--accent-color);
            flex-shrink: 0;
        }

        .recent-files-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .recent-files-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            padding: 25px 30px;
            overflow-y: auto;
            flex: 1;
        }

        /* GELİŞTİRİLMİŞ - RECENT FILE ITEM YÜKSEKLİĞİ */
        .recent-file-item {
            background: rgba(255, 255, 255, 0.08);
            border-radius: 10px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            position: relative;
            overflow: visible; /* Hidden yerine visible yapıldı */
            min-height: 120px; /* Minimum yükseklik eklendi */
            display: flex;
            flex-direction: column;
            justify-content: space-between; /* İçeriği düzgün dağıt */
        }

        .recent-file-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s ease;
        }

        .recent-file-item:hover {
            background: rgba(255, 255, 255, 0.15);
            border-left-color: var(--accent-color);
            transform: translateX(8px);
        }

        .recent-file-item:hover::before {
            left: 100%;
        }

        .recent-file-name {
            color: white;
            font-weight: bold;
            margin-bottom: 12px; /* Margin artırıldı */
            font-size: 15px;
            word-break: break-word;
            line-height: 1.3; /* Line height eklendi */
        }

        .recent-file-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
            margin-bottom: 10px; /* Margin artırıldı */
            flex-wrap: wrap; /* Wrap eklendi küçük ekranlar için */
            gap: 8px; /* Gap eklendi */
        }

        .recent-file-pages {
            color: var(--accent-color);
            font-weight: 600;
        }

        .recent-file-date {
            color: rgba(255, 255, 255, 0.7);
        }

        .recent-file-lastpage {
            color: rgba(255, 255, 255, 0.8);
            font-size: 12px;
            font-style: italic;
            margin-top: auto; /* Bu satırı alta iter */
        }

        .clear-recent-btn {
            background: rgba(231, 76, 60, 0.8);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            transition: all 0.3s ease;
            margin: 0 30px 30px 30px;
            font-weight: 600;
            flex-shrink: 0;
        }

        .clear-recent-btn:hover {
            background: rgba(231, 76, 60, 1);
            transform: translateY(-2px);
        }

        /* Theme Selection Popup */
        .theme-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(12px);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .theme-popup.show {
            display: flex;
        }

        .theme-popup-content {
            background: var(--popup-bg);
            border: 1px solid var(--popup-border);
            border-radius: 20px;
            padding: 30px;
            max-width: 650px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.6);
        }

        .theme-popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--popup-border);
        }

        .theme-popup-title {
            color: var(--accent-color);
            font-size: 22px;
            font-weight: bold;
        }

        .theme-close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 28px;
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.2s ease;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 18px;
            margin-bottom: 30px;
        }

        .theme-option {
            aspect-ratio: 2/1;
            border-radius: 12px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            border: 3px solid transparent;
            overflow: hidden;
        }

        .theme-option:hover {
            transform: scale(1.08);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        .theme-option.active {
            border-color: #ffffff;
            box-shadow: 0 0 0 3px var(--accent-color);
            transform: scale(1.05);
        }

        .theme-option.active::after {
            content: '✓';
            position: absolute;
            top: 8px;
            right: 12px;
            color: white;
            font-size: 20px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.8);
        }

        /* Theme option gradients */
        .theme-option[data-theme="default"] {
            background: linear-gradient(135deg, #2c3e50, #3498db, #e8ebb4);
        }

        .theme-option[data-theme="forest"] {
            background: linear-gradient(135deg, #2d5a27, #4a7c59, #a7c957);
        }

        .theme-option[data-theme="sunset"] {
            background: linear-gradient(135deg, #c73e1d, #f18701, #fcbf49);
        }

        .theme-option[data-theme="ocean"] {
            background: linear-gradient(135deg, #03045e, #0077b6, #90e0ef);
        }

        .theme-option[data-theme="purple"] {
            background: linear-gradient(135deg, #5a189a, #7209b7, #c77dff);
        }

        .theme-option[data-theme="dark"] {
            background: linear-gradient(135deg, #1a1a1a, #2c2c2c, #4a9eff);
        }

        .theme-option[data-theme="golden"] {
            background: linear-gradient(135deg, #b8860b, #daa520, #ffd700);
        }

        .theme-option[data-theme="emerald"] {
            background: linear-gradient(135deg, #0f5132, #20c997, #d1ecf1);
        }

        .theme-option[data-theme="crimson"] {
            background: linear-gradient(135deg, #8b0000, #ff1744, #ffcdd2);
        }

        .theme-option[data-theme="royal"] {
            background: linear-gradient(135deg, #4b0082, #9370db, #e6e6fa);
        }

        .custom-theme-section {
            padding-top: 25px;
            border-top: 2px solid var(--popup-border);
        }

        .custom-theme-title {
            color: var(--accent-color);
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .custom-theme-controls {
            display: flex;
            gap: 20px;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .color-input-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .color-input-label {
            color: var(--text-secondary);
            font-size: 13px;
            font-weight: 600;
        }

        .color-input {
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background: none;
            transition: transform 0.2s ease;
        }

        .color-input:hover {
            transform: scale(1.1);
        }

        .apply-custom-theme {
            background: var(--accent-color);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .apply-custom-theme:hover {
            opacity: 0.8;
            transform: translateY(-2px);
        }

        /* Info and Hotkey Popups */
        .info-popup, .hotkey-popup {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1500;
            backdrop-filter: blur(8px);
        }

        .info-popup.show, .hotkey-popup.show {
            display: flex;
        }

        .info-content, .hotkey-content {
            background: var(--popup-bg);
            border: 1px solid var(--popup-border);
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(15px);
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .popup-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 30px 30px 20px 30px;
            border-bottom: 2px solid var(--accent-color);
            flex-shrink: 0;
        }

        .popup-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--accent-color);
        }

        .popup-content-scrollable {
            padding: 25px 30px;
            overflow-y: auto;
            flex: 1;
        }

        .popup-text {
            color: var(--text-primary);
            line-height: 1.6;
            text-align: justify;
            margin-bottom: 20px;
        }

        .hotkey-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .hotkey-table th,
        .hotkey-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--popup-border);
            color: var(--text-primary);
        }

        .hotkey-table th {
            background: rgba(255, 255, 255, 0.1);
            font-weight: bold;
            color: var(--accent-color);
        }

        .hotkey-table tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .hotkey-key {
            background: rgba(255, 255, 255, 0.2);
            padding: 4px 8px;
            border-radius: 4px;
            font-family: monospace;
            font-weight: bold;
            font-size: 12px;
        }

        .popup-footer {
            text-align: center;
            padding: 20px 30px 30px 30px;
            border-top: 1px solid var(--popup-border);
            color: var(--accent-color);
            font-weight: bold;
            flex-shrink: 0;
        }

        /* Toast Messages */
        .toast {
            position: fixed;
            top: -100px;
            right: 25px;
            background: #333;
            color: white;
            padding: 15px 25px;
            border-radius: 10px;
            z-index: 3000;
            transform: translateX(100%);
            transition: all 0.4s ease;
            max-width: 350px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
            opacity: 0;
            visibility: hidden;
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(0);
            top: 60px;
            opacity: 1;
            visibility: visible;
        }

        .toast.success {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }

        .toast.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        .toast.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }

        .toast.info {
            background: linear-gradient(135deg, var(--accent-color), #2980b9);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(8px);
        }

        .loading-overlay.show {
            display: flex;
        }

        .loading-content {
            text-align: center;
            color: white;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* ENHANCED RESPONSIVE ANIMATIONS */
        @keyframes flash {
            0% { background-color: rgba(46, 204, 113, 0.3); }
            50% { background-color: rgba(46, 204, 113, 0.7); }
            100% { background-color: rgba(46, 204, 113, 0.3); }
        }

        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.8; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes slideInFromRight {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInFromLeft {
            0% { transform: translateX(-100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }

        @keyframes bounceIn {
            0% { transform: scale(0.3); opacity: 0; }
            50% { transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes rotateIn {
            0% { transform: rotate(-180deg) scale(0.5); opacity: 0; }
            100% { transform: rotate(0deg) scale(1); opacity: 1; }
        }

        /* ENHANCED SELECTION OVERLAY STYLES */
        .new-selection-overlay {
            border-radius: 3px;
            box-shadow: 0 0 0 2000px rgba(0, 0, 0, 0.1);
            animation: pulse 1s infinite;
        }

        .lasso-selection-overlay {
            border-radius: 3px;
            box-shadow: 0 2px 10px rgba(231, 76, 60, 0.3);
        }

        .lasso-selection-svg {
            filter: drop-shadow(0 2px 4px rgba(0, 0, 0, 0.2));
        }

        .loading-content h3 {
            margin-bottom: 15px;
            font-size: 1.4rem;
        }

        .progress-bar {
            width: 250px;
            height: 8px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            overflow: hidden;
            margin: 15px auto;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-color), #2980b9);
            transition: width 0.3s ease;
            width: 0%;
        }

        /* ENHANCED BOOKMARKS PANEL WITH AUTO-CLOSE */
        .bookmarks-panel {
            position: fixed;
            left: -350px;
            top: 45px;
            width: 320px;
            height: calc(100vh - 90px);
            background: var(--bookmarks-bg);
            backdrop-filter: blur(15px);
            border-right: 1px solid rgba(255, 255, 255, 0.15);
            z-index: 200;
            transition: left 0.4s ease;
            overflow-y: auto;
            border-radius: 0 12px 12px 0;
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.3);
        }

        .bookmarks-panel.show {
            left: 0;
        }

        .bookmarks-header {
            color: white;
            font-size: 1.3rem;
            font-weight: bold;
            padding: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.2);
            background: rgba(0, 0, 0, 0.2);
            position: sticky;
            top: 0;
            z-index: 1;
        }

        .bookmarks-list {
            padding: 15px;
            max-height: calc(100vh - 150px);
            overflow-y: auto;
            overflow-x: hidden;
            -webkit-overflow-scrolling: touch;
            scrollbar-width: thin;
            scrollbar-color: var(--accent-color) transparent;
        }

        .bookmarks-list::-webkit-scrollbar {
            width: 8px;
        }

        .bookmarks-list::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
        }

        .bookmarks-list::-webkit-scrollbar-thumb {
            background: var(--accent-color);
            border-radius: 4px;
            opacity: 0.7;
        }

        .bookmarks-list::-webkit-scrollbar-thumb:hover {
            background: var(--active-color);
            opacity: 1;
        }

        .bookmark-item {
            color: rgba(255, 255, 255, 0.8);
            padding: 15px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
        }

        .bookmark-item:hover {
            background: rgba(255, 255, 255, 0.15);
            border-left-color: var(--accent-color);
            transform: translateX(8px);
        }

        /* ENHANCED MOBILE RESPONSIVE DESIGN */
        @media (max-width: 1200px) {
            .features-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .feature-item {
                padding: 18px 12px;
                min-height: 110px;
            }
        }

        /* MOBILE PORTRAIT MODE - ENHANCED */
        @media (max-width: 768px) {
            .welcome-screen {
                height: calc(100vh - 90px);
                min-height: calc(100vh - 90px);
                max-height: calc(100vh - 90px);
            }

            .welcome-content {
                height: 100%;
                padding: 15px;
                margin: 5px;
            }

            .header {
                flex-direction: row;
                height: auto;
                min-height: 40px;
                padding: 4px 8px;
                gap: 6px;
                flex-wrap: nowrap;
            }

            .header-left {
                flex: 0 0 auto;
                order: 1;
                gap: 8px;
            }

            .header-center {
                flex: 1;
                order: 2;
                min-width: 0;
            }

            .header-right {
                flex: 0 0 auto;
                order: 3;
                gap: 3px;
            }

            .header-title {
                font-size: 12px;
                font-weight: bold;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .icon-group {
                gap: 3px;
                flex-wrap: nowrap;
                overflow-x: auto;
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            .icon-group::-webkit-scrollbar {
                display: none;
            }

            .icon {
                width: 18px;
                height: 18px;
                font-size: 10px;
                flex-shrink: 0;
                padding: 2px;
            }

            .logo {
                height: 26px;
                width: 26px;
                flex-shrink: 0;
                font-size: 12px;
            }

            /* ENHANCED 2-COLUMN LAYOUT FOR MOBILE TOOLS */
            .tool-group {
                flex-direction: row;
                flex-wrap: wrap;
                width: 100%;
                padding: 3px 2px;
                border-right: none;
                border-bottom: 1px solid rgba(255, 255, 255, 0.15);
                margin-bottom: 3px;
                justify-content: space-between;
                gap: 2px;
            }

            .tool-group:last-child {
                border-bottom: none;
            }

            .drawing-tool {
                width: 22px;
                height: 22px;
                font-size: 10px;
                margin-bottom: 1px;
                flex: 0 0 calc(50% - 1px);
            }

            .color-picker {
                width: 18px;
                height: 18px;
                margin-bottom: 1px;
                flex: 0 0 calc(50% - 1px);
            }

            .brush-size-group, .advanced-controls {
                flex-direction: column;
                padding: 4px 2px;
                width: 100%;
            }

            .brush-size-slider, .opacity-slider {
                width: 25px;
                height: 40px;
                writing-mode: bt-lr;
                -webkit-appearance: slider-vertical;
                appearance: slider-vertical;
            }

            /* ENHANCED BOOKMARKS PANEL FOR MOBILE */
            .bookmarks-panel {
                width: 300px;
                left: calc(-100vw + 8px);
                height: calc(100vh - 90px);
                top: 42px;
            }

            .bookmarks-panel.show {
                left: 8px;
            }

            .welcome-title {
                font-size: 1.6rem;
                margin-bottom: 10px;
            }

            .welcome-subtitle {
                font-size: 0.9rem;
                margin-bottom: 15px;
            }

            .features-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
                margin-bottom: 20px;
            }

            .feature-item {
                padding: 15px 10px;
                min-height: 100px;
            }

            .feature-icon {
                font-size: 1.6rem;
                margin-bottom: 8px;
            }

            .feature-title {
                font-size: 0.9rem;
                margin-bottom: 4px;
            }

            .feature-desc {
                font-size: 0.75rem;
                line-height: 1.3;
            }

            .start-buttons {
                gap: 8px;
            }

            .btn {
                padding: 10px 16px;
                font-size: 12px;
                min-width: 100px;
            }

            .theme-popup-content {
                width: 95%;
                padding: 20px;
            }

            .theme-grid {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }

            .pdf-page {
                width: calc(100vw - 10px) !important;
                max-width: calc(100vw - 10px) !important;
            }

            .auto-scroll-container, .zoom-container {
                min-width: 260px;
                padding: 8px 15px;
            }

            .footer {
                padding: 3px 6px;
                height: 40px;
            }

            .footer-icon, .page-icon {
                width: 20px;
                height: 20px;
                font-size: 11px;
                padding: 3px;
            }

            .page-input {
                width: 32px;
                font-size: 9px;
                padding: 3px;
            }

            .page-info {
                font-size: 9px;
            }

            .toolbar-move-handle {
                width: 32px;
                height: 32px;
                margin-bottom: 4px;
                margin-right: 0;
                font-size: 10px;
            }

            /* MOBİL İÇİN GELİŞTİRİLMİŞ RECENT FILES */
            .recent-file-item {
                min-height: 140px; /* Mobilde daha yüksek */
                padding: 18px;
            }

            .recent-file-name {
                font-size: 14px;
                margin-bottom: 10px;
            }

            .recent-file-details {
                font-size: 12px;
                margin-bottom: 8px;
            }

            .recent-file-lastpage {
                font-size: 11px;
            }
        }

        /* VERY SMALL SCREENS */
        @media (max-width: 480px) {
            .header-title {
                font-size: 10px;
            }

            .custom-theme-controls {
                flex-direction: column;
                align-items: flex-start;
            }

            .welcome-content {
                padding: 10px;
                margin: 2px;
            }

            .welcome-title {
                font-size: 1.4rem;
            }

            .btn {
                padding: 8px 12px;
                font-size: 11px;
                min-width: 90px;
            }

            .auto-scroll-container, .zoom-container {
                min-width: 220px;
                padding: 6px 12px;
            }

            .footer {
                gap: 3px;
                padding: 2px 4px;
            }

            .footer-left,
            .footer-right {
                gap: 3px;
            }

            .drawing-toolbar {
                width: 48px;
                left: 2px;
            }

            .drawing-tool {
                width: 20px;
                height: 20px;
                font-size: 9px;
            }

            .color-picker {
                width: 16px;
                height: 16px;
            }

            .theme-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 8px;
            }

            .bookmarks-panel {
                width: 280px;
                left: calc(-100vw + 5px);
            }

            .bookmarks-panel.show {
                left: 5px;
            }

            /* ÇOK KÜÇÜK EKRANLAR İÇİN RECENT FILES */
            .recent-file-item {
                min-height: 150px; /* En küçük ekranlarda daha da yüksek */
                padding: 16px;
            }
        }

        /* Animation keyframes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateX(-100%); }
            to { transform: translateX(0); }
        }

        /* Performance optimizations */
        .pdf-page, .drawing-canvas {
            transform: translateZ(0);
            will-change: transform;
        }

        /* Smooth scrolling improvements */
        .main-content {
            scroll-behavior: smooth;
        }

        /* High DPI optimizations */
        @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
            .drawing-tool, .color-picker {
                image-rendering: -webkit-optimize-contrast;
            }
        }

        /* CLIPBOARD PASTE SUPPORT */
        .clipboard-overlay {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            z-index: 2500;
            display: none;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .clipboard-overlay.show {
            display: block;
        }

        /* THUMBNAIL PANEL STYLES - GELİŞTİRİLMİŞ LAZY LOADING İÇİN */
        .thumbnail-panel {
            position: fixed;
            top: 45px;
            left: 0;
            right: 0;
            bottom: 45px;
            background: var(--thumbnail-bg);
            backdrop-filter: blur(15px);
            z-index: 200;
            display: none;
            flex-direction: column;
            padding: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .thumbnail-panel.show {
            display: flex;
        }

        .thumbnail-header {
            color: white;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .thumbnail-close-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.2s ease;
        }

        .thumbnail-close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .thumbnail-grid {
            flex: 1;
            overflow-y: auto;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            padding: 10px;
            align-content: start;
            -webkit-overflow-scrolling: touch;
        }

        .thumbnail-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            padding: 10px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            border: 2px solid transparent;
            opacity: 0;
            transform: translateY(20px);
            animation: thumbnailFadeIn 0.3s ease forwards;
            min-height: 180px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        @keyframes thumbnailFadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .thumbnail-item.loading {
            opacity: 0.5;
        }

        .thumbnail-item.loading .thumbnail-canvas {
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 25%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.1) 75%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            height: 120px;
            border-radius: 4px;
        }

        @keyframes shimmer {
            0% {
                background-position: -200% 0;
            }
            100% {
                background-position: 200% 0;
            }
        }

        .thumbnail-item:hover {
            background: var(--thumbnail-hover);
            border-color: var(--accent-color);
            transform: scale(1.02);
        }

        .thumbnail-item.current {
            border-color: var(--active-color);
            background: rgba(249, 115, 22, 0.2);
        }

        .thumbnail-canvas {
            width: 100%;
            max-width: 130px;
            height: auto;
            min-height: 120px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            object-fit: contain;
            background: rgba(255, 255, 255, 0.1);
            margin: 0 auto;
        }

        .thumbnail-label {
            color: white;
            font-size: 12px;
            margin-top: 8px;
            font-weight: 500;
            flex-shrink: 0;
        }

        .thumbnail-footer {
            text-align: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 14px;
            padding: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
        }

        /* ENHANCED LAZY LOADING THUMBNAIL SPECIFIC STYLES */
        .thumbnail-placeholder {
            width: 100%;
            height: 120px;
            background: linear-gradient(45deg, rgba(255,255,255,0.05) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.05) 75%, rgba(255,255,255,0.05)),
                        linear-gradient(45deg, rgba(255,255,255,0.05) 25%, transparent 25%, transparent 75%, rgba(255,255,255,0.05) 75%, rgba(255,255,255,0.05));
            background-size: 20px 20px;
            background-position: 0 0, 10px 10px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 12px;
            border: 1px dashed rgba(255, 255, 255, 0.2);
            animation: pulse 2s infinite;
        }

        .thumbnail-progress {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0 0 4px 4px;
            overflow: hidden;
        }

        .thumbnail-progress-bar {
            height: 100%;
            background: var(--accent-color);
            width: 0%;
            transition: width 0.3s ease;
        }

        @media (max-width: 768px) {
            .thumbnail-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
                gap: 10px;
                padding: 5px;
            }

            .thumbnail-item {
                padding: 8px;
                min-height: 160px;
            }

            .thumbnail-canvas {
                max-width: 100px;
                min-height: 100px;
            }

            .thumbnail-label {
                font-size: 11px;
            }

            .thumbnail-placeholder {
                height: 100px;
            }
        }
    </style>
</head>
<body class="theme-default">
<!-- ENHANCED RESPONSIVE HEADER -->
<header class="header">
    <div class="header-left">
        <div class="logo" onclick="toggleInfo()" title="BELGESELSEMO - Logo"></div>
    </div>

    <div class="header-center">
        <span class="header-title">Kur'an-ı Kerim Arapça & Türkçe Mealli</span>
    </div>

    <div class="header-right">
        <div class="icon-group">
            <i class="fas fa-folder-open icon" onclick="openFilePicker()" title="PDF Dosyası Aç"></i>
            <i class="fas fa-link icon" onclick="showUrlPopup(event)" title="URL'den PDF Aç"></i>
            <i class="fas fa-search icon" onclick="openSearchModal(event)" title="PDF'de Ara"></i>
            <i class="fas fa-bookmark icon" onclick="toggleBookmarks(event)" title="Yer İmleri"></i>
            <i class="fas fa-undo icon" onclick="rotatePDF(-90)" title="Sola Döndür"></i>
            <i class="fas fa-redo icon" onclick="rotatePDF(90)" title="Sağa Döndür"></i>
            <i class="fas fa-palette icon" onclick="showThemePopup(event)" title="Tema Değiştir"></i>
            <i class="fas fa-info-circle icon" onclick="showInfoPopup(event)" title="Bilgi"></i>
            <i class="fas fa-keyboard icon" onclick="showHotkeyPopup(event)" title="Kısayollar"></i>
            <i class="fas fa-expand icon" onclick="toggleFullscreen()" title="Tam Ekran"></i>
        </div>
    </div>
</header>

<!-- Drop Zone for Drag & Drop -->
<div class="drop-zone" id="dropZone">
    <div class="drop-zone-content">
        <div class="drop-zone-icon">
            <i class="fas fa-file-pdf"></i>
        </div>
        <div>PDF dosyasını buraya sürükleyip bırakın</div>
        <div style="font-size: 1.2rem; margin-top: 10px; opacity: 0.8;">
            Desteklenen format: .pdf
        </div>
    </div>
</div>

<!-- ULTRA ENHANCED DRAGGABLE DRAWING TOOLBAR WITH ALL SHAPES + NUMBER LINE -->
<div class="drawing-toolbar" id="drawingToolbar">
    <!-- MOVE HANDLE FOR DRAGGING -->
    <div class="toolbar-move-handle" id="toolbarMoveHandle" title="Araç çubuğunu taşı">
        <i class="fas fa-grip-vertical"></i>
    </div>

    <!-- Basic Drawing Tools -->
    <div class="tool-group">
        <button class="drawing-tool active" id="penTool" onclick="selectTool('pen')" title="Kalem (P)">
            <i class="fas fa-pen"></i>
        </button>
        <button class="drawing-tool" id="eraserTool" onclick="selectTool('eraser')" title="Silgi (E)">
            <i class="fas fa-eraser"></i>
        </button>
        <button class="drawing-tool" id="highlightTool" onclick="selectTool('highlight')" title="Fosforlu Kalem (H)">
            <i class="fas fa-highlighter"></i>
        </button>
        <button class="drawing-tool" id="handTool" onclick="selectTool('hand')" title="El (G)">
            <i class="fas fa-hand-paper"></i>
        </button>
        <button class="drawing-tool" id="textTool" onclick="selectTool('text')" title="Metin (T)">
            <i class="fas fa-font"></i>
        </button>
    </div>

    <!-- Selection Tools -->
    <div class="tool-group">
        <button class="drawing-tool" id="rectSelectTool" onclick="selectTool('rectSelect')" title="Dikdörtgen Seçim (S)">
            <i class="fas fa-vector-square"></i>
        </button>
        <button class="drawing-tool" id="lassoTool" onclick="selectTool('lasso')" title="Lasso Seçim (L)">
            <i class="fas fa-bezier-curve"></i>
        </button>
        <button class="drawing-tool" id="selectDeleteTool" onclick="selectTool('selectDelete')" title="Seçerek Sil">
            <i class="fas fa-trash-alt"></i>
        </button>
        <button class="drawing-tool" id="selectAllTool" onclick="selectAllDrawings()" title="Tümünü Seç (Ctrl+A)">
            <i class="fas fa-check-square"></i>
        </button>
        <button class="drawing-tool" id="deleteSelectedTool" onclick="deleteSelectedDrawings()" title="Seçilenleri Sil (Delete)">
            <i class="fas fa-trash"></i>
        </button>
        <button class="drawing-tool" id="screenshotTool" onclick="selectTool('screenshot')" title="Ekran Alıntısı (C)">
            <i class="fas fa-camera"></i>
        </button>
        <button class="drawing-tool" id="measureTool" onclick="selectTool('measure')" title="Ölçüm (M)">
            <i class="fas fa-ruler"></i>
        </button>
        <button class="drawing-tool" id="numberlineTool" onclick="selectTool('numberline')" title="Sayı Doğrusu (N)">
            <i class="fas fa-grip-lines"></i>
        </button>
    </div>

    <!-- Basic Shapes -->
    <div class="tool-group">
        <button class="drawing-tool" id="lineTool" onclick="selectTool('line')" title="Çizgi">
            <i class="fas fa-minus"></i>
        </button>
        <button class="drawing-tool" id="dashedLineTool" onclick="selectTool('dashedLine')" title="Kesikli Çizgi">
            <i class="fas fa-grip-lines"></i>
        </button>
        <button class="drawing-tool" id="arrowTool" onclick="selectTool('arrow')" title="Ok">
            <i class="fas fa-arrow-right"></i>
        </button>
        <button class="drawing-tool" id="straightLineTool" onclick="selectTool('straightLine')" title="Doğru (↔)">
            <span style="font-size: 12px;">↔</span>
        </button>
        <button class="drawing-tool" id="rectangleTool" onclick="selectTool('rectangle')" title="Dikdörtgen">
            <i class="fas fa-square"></i>
        </button>
        <button class="drawing-tool" id="circleTool" onclick="selectTool('circle')" title="Daire">
            <i class="fas fa-circle"></i>
        </button>
        <button class="drawing-tool" id="ellipseTool" onclick="selectTool('ellipse')" title="Elips">
            <i class="fas fa-circle" style="transform: scaleX(0.7);"></i>
        </button>
    </div>

    <!-- Geometric Shapes -->
    <div class="tool-group">
        <button class="drawing-tool" id="triangleTool" onclick="selectTool('triangle')" title="Üçgen">
            <span style="font-size: 9px;">▲</span>
        </button>
        <button class="drawing-tool" id="straightLineTool" onclick="selectTool('straightLine')" title="Doğru (↔)">
            <span style="font-size: 12px;">↔</span>
        </button>
        <button class="drawing-tool" id="pentagonTool" onclick="selectTool('pentagon')" title="Beşgen">
            <span style="font-size: 9px;">⬟</span>
        </button>
        <button class="drawing-tool" id="hexagonTool" onclick="selectTool('hexagon')" title="Altıgen">
            <span style="font-size: 9px;">⬢</span>
        </button>
        <button class="drawing-tool" id="heptagonTool" onclick="selectTool('heptagon')" title="Yedigen">
            <span style="font-size: 9px;">⬢</span>
        </button>
        <button class="drawing-tool" id="crescentTool" onclick="selectTool('crescent')" title="Hilal">
            <i class="fas fa-moon"></i>
        </button>
        <button class="drawing-tool" id="starTool" onclick="selectTool('star')" title="Yıldız">
            <i class="fas fa-star"></i>
        </button>
    </div>

    <!-- Complex Shapes -->
    <div class="tool-group">
        <button class="drawing-tool" id="trapezoidTool" onclick="selectTool('trapezoid')" title="Yamuk">
            <span style="font-size: 7px;">⏢</span>
        </button>
        <button class="drawing-tool" id="parallelogramTool" onclick="selectTool('parallelogram')" title="Paralelkenar">
            <span style="font-size: 9px;">▱</span>
        </button>
        <button class="drawing-tool" id="deltoidTool" onclick="selectTool('deltoid')" title="Deltoid">
            <span style="font-size: 9px;">◊</span>
        </button>
        <button class="drawing-tool" id="cubeTool" onclick="selectTool('cube')" title="Küp">
            <span style="font-size: 9px;">⬜</span>
        </button>
        <button class="drawing-tool" id="coneTool" onclick="selectTool('cone')" title="Koni">
            <span style="font-size: 9px;">🔺</span>
        </button>
        <button class="drawing-tool" id="cylinderTool" onclick="selectTool('cylinder')" title="Silindir">
            <span style="font-size: 9px;">⬭</span>
        </button>
    </div>

    <!-- Prism Shapes -->
    <div class="tool-group">
        <button class="drawing-tool" id="triangularPrismTool" onclick="selectTool('triangularPrism')" title="Üçgen Prizma">
            <span style="font-size: 7px;">△</span>
        </button>
        <button class="drawing-tool" id="rectangularPrismTool" onclick="selectTool('rectangularPrism')" title="Dikdörtgen Prizma">
            <span style="font-size: 7px;">▭</span>
        </button>
    </div>

    <!-- Advanced Controls -->
    <div class="advanced-controls">
        <label style="color: rgba(255,255,255,0.8); font-size: 9px;">Kalınlık:</label>
        <input type="range" class="brush-size-slider" id="brushSizeSlider" min="1" max="20" value="1" oninput="setBrushSize(this.value)">
        <div class="brush-size-display" id="brushSizeDisplay">1px</div>
    </div>

    <div class="advanced-controls">
        <label style="color: rgba(255,255,255,0.8); font-size: 9px;">Şeffaflık:</label>
        <input type="range" class="opacity-slider" id="opacitySlider" min="10" max="100" value="100" oninput="setOpacity(this.value)">
        <div class="brush-size-display" id="opacityDisplay">100%</div>
    </div>

    <!-- Grid Controls -->
    <div class="tool-group">
        <button class="drawing-tool" id="gridTool" onclick="toggleGrid()" title="Izgara">
            <i class="fas fa-th"></i>
        </button>
        <button class="drawing-tool" id="snapTool" onclick="toggleSnap()" title="Yakalama">
            <i class="fas fa-magnet"></i>
        </button>
    </div>

    <!-- Color Palette -->
    <div class="tool-group">
        <div class="color-picker active" style="background: #ff0000;" onclick="selectColor('#ff0000')" title="Kırmızı"></div>
        <div class="color-picker" style="background: #00ff00;" onclick="selectColor('#00ff00')" title="Yeşil"></div>
        <div class="color-picker" style="background: #0000ff;" onclick="selectColor('#0000ff')" title="Mavi"></div>
        <div class="color-picker" style="background: #000000;" onclick="selectColor('#000000')" title="Siyah"></div>
        <div class="color-picker" style="background: #ffff00;" onclick="selectColor('#ffff00')" title="Sarı"></div>
        <div class="color-picker" style="background: #800080;" onclick="selectColor('#800080')" title="Mor"></div>
        <div class="color-picker" style="background: #ffa500;" onclick="selectColor('#ffa500')" title="Turuncu"></div>
        <div class="color-picker" style="background: #ffffff;" onclick="selectColor('#ffffff')" title="Beyaz"></div>
    </div>

    <!-- Action Tools -->
    <div class="tool-group">
        <button class="drawing-tool" onclick="undoDrawing()" title="Geri Al (Ctrl+Z)">
            <i class="fas fa-undo"></i>
        </button>
        <button class="drawing-tool" onclick="redoDrawing()" title="İleri Al (Ctrl+Y)">
            <i class="fas fa-redo"></i>
        </button>
        <button class="drawing-tool" onclick="clearAllDrawing()" title="Temizle">
            <i class="fas fa-trash"></i>
        </button>
        <button class="drawing-tool" onclick="saveDrawing()" title="Kaydet (Ctrl+S)">
            <i class="fas fa-save"></i>
        </button>
    </div>

    <!-- Multi-Selection Tools -->
    <div class="tool-group">
        <button class="drawing-tool" onclick="selectAllDrawings()" title="Tümünü Seç (Ctrl+A)">
            <i class="fas fa-mouse-pointer"></i>
            <span class="selection-count" id="selectionCount" style="display: none;">0</span>
        </button>
        <button class="drawing-tool" onclick="deleteSelectedDrawings()" title="Seçilenleri Sil (Delete)">
            <i class="fas fa-trash-alt"></i>
        </button>
        <button class="drawing-tool" onclick="copySelectedDrawings()" title="Kopyala (Ctrl+C)">
            <i class="fas fa-copy"></i>
        </button>
        <button class="drawing-tool" onclick="pasteDrawings()" title="Yapıştır (Ctrl+V)">
            <i class="fas fa-paste"></i>
        </button>
    </div>
</div>

<!-- Main Content -->
<main class="main-content" id="mainContent">
    <!-- Welcome Screen - ARTIK GÖSTERİLMEYECEK -->
    <div class="welcome-screen" id="welcomeScreen" style="display: none;">
        <div class="welcome-content">
            <h1 class="welcome-title">Kur'an-ı Kerim Arapça & Türkçe Mealli</h1>
            <p class="welcome-subtitle">%40 BOLT.NEW, %60 REPLIT AI sayesinde BELGESELSEMO tarafından hazırlanmıştır...</p>

            <div class="features-grid">
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-file-upload"></i></div>
                    <div class="feature-title">Dosya Yükleme</div>
                    <div class="feature-desc">Yerel dosya seçimi, sürükle-bırak ve uzak URL ile PDF açma. Çoklu format desteği ve anlık yükleme.</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-sticky-note"></i></div>
                    <div class="feature-title">Not & Yer İmleri</div>
                    <div class="feature-desc">Kategorili not alma, favori işaretleme, yer imi oluşturma ve sürükle-bırak ile dosya yönetimi.</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-layer-group"></i></div>
                    <div class="feature-title">Popup Menüler</div>
                    <div class="feature-desc">Bilgi popup'ı, kısayollar rehberi, son açılan dosyalar ve sayfa önizleme paneli ile hızlı erişim.</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-play-circle"></i></div>
                    <div class="feature-title">Otomatik Kaydırma</div>
                    <div class="feature-desc">Ayarlanabilir hız ile otomatik sayfa kaydırma, durdurup devam ettirme ve yumuşak geçişler.</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-paint-brush"></i></div>
                    <div class="feature-title">Çizim Araçları</div>
                    <div class="feature-desc">25+ geometrik şekil, fırça, kalem, silgi, metin araçları ve gelişmiş seçim özellikleri ile tam çizim desteği.</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-search"></i></div>
                    <div class="feature-title">Arama & Döndürme</div>
                    <div class="feature-desc">Hızlı metin arama, sonuç önizleme, sayfa döndürme ve 360° görüntü manipülasyonu.</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-mouse-pointer"></i></div>
                    <div class="feature-title">Sağ Tık Menüsü</div>
                    <div class="feature-desc">Bağlamsal sağ tık menüsü ile hızlı işlemler, kopyalama, yapıştırma ve gelişmiş seçenekler.</div>
                </div>
                <div class="feature-item">
                    <div class="feature-icon"><i class="fas fa-search-plus"></i></div>
                    <div class="feature-title">Zoom Araçları</div>
                    <div class="feature-desc">Esnek zoom seviyeleri, sayfa genişliğine sığdırma, tam ekran modu ve hassas büyütme kontrolleri.</div>
                </div>
            </div>

            <div class="start-buttons">
                <button class="btn btn-primary" onclick="openFilePicker()">
                    <i class="fas fa-file-upload"></i>
                    Dosya Seç
                </button>
                <button class="btn btn-secondary" onclick="showUrlPopup()">
                    <i class="fas fa-link"></i>
                    URL'den Aç
                </button>
                <button class="btn btn-outline" onclick="showRecentFiles(event)" id="recentFilesBtn">
                    <i class="fas fa-history"></i>
                    Son Açılanlar
                </button>
            </div>
        </div>
    </div>

    <!-- PDF Container -->
    <div class="pdf-container" id="pdfContainer">
        <!-- PDF pages will be inserted here -->
    </div>
</main>

<!-- Enhanced Footer -->
<footer class="footer">
    <div class="footer-left">
        <div class="footer-icon" onclick="goHome()" title="Ana Sayfa">
            <i class="fas fa-home"></i>
        </div>
        <div class="footer-icon" onclick="showRecentFiles(event)" title="Son Açılanlar">
            <i class="fas fa-history"></i>
        </div>
        <div class="footer-icon" onclick="showNotesModal(event)" title="Not Listesi">
            <i class="fas fa-sticky-note"></i>
        </div>
        <div class="footer-icon" onclick="toggleThumbnailPanel(event)" title="Sayfa Önizlemeleri">
            <i class="fas fa-th-large"></i>
        </div>
    </div>

    <div class="footer-center">
        <div class="page-nav">
            <div class="page-icon" onclick="goToFirstPage()" title="İlk Sayfa">
                <i class="fas fa-angle-double-left"></i>
            </div>
            <div class="page-icon" onclick="previousPage()" title="Önceki Sayfa">
                <i class="fas fa-angle-left"></i>
            </div>
            <input type="number" class="page-input" id="pageInput" min="1" value="1" onchange="handlePageInputChange()">
            <span class="page-info" id="pageInfo">/ 0</span>
            <div class="page-icon" onclick="nextPage()" title="Sonraki Sayfa">
                <i class="fas fa-angle-right"></i>
            </div>
            <div class="page-icon" onclick="goToLastPage()" title="Son Sayfa">
                <i class="fas fa-angle-double-right"></i>
            </div>
        </div>
    </div>

    <div class="footer-right">
        <div class="footer-icon" onclick="toggleDrawingTools()" title="Çizim Araçları">
            <i class="fas fa-paint-brush"></i>
        </div>
        <div class="footer-icon" id="autoScrollIcon" onclick="toggleAutoScroll()" title="Otomatik Kaydırma">
            <i class="fas fa-play"></i>
        </div>
        <div class="footer-icon" onclick="toggleZoomControls()" title="Zoom">
            <i class="fas fa-search-plus"></i>
        </div>
    </div>
</footer>

<!-- Auto Scroll Speed Control -->
<div class="auto-scroll-container" id="autoScrollContainer">
    <button class="scroll-speed-btn" onclick="decreaseScrollSpeed()" title="Yavaşlat">
        <i class="fas fa-minus"></i>
    </button>
    <input type="range" class="scroll-speed-slider" id="scrollSpeedSlider" min="1" max="10" value="3" oninput="setScrollSpeed(this.value)">
    <button class="scroll-speed-btn" onclick="increaseScrollSpeed()" title="Hızlandır">
        <i class="fas fa-plus"></i>
    </button>
    <div class="scroll-speed-value" id="scrollSpeedValue">3x</div>
    <button class="scroll-speed-btn" onclick="toggleAutoScroll()" title="Durdur">
        <i class="fas fa-stop"></i>
    </button>
</div>

<!-- Zoom Control -->
<div class="zoom-container" id="zoomContainer">
    <button class="zoom-btn" onclick="zoomOut()" title="Uzaklaştır">
        <i class="fas fa-minus"></i>
    </button>
    <input type="range" class="zoom-slider" id="zoomSlider" min="25" max="500" value="250" oninput="setZoom(this.value)">
    <button class="zoom-btn" onclick="zoomIn()" title="Yakınlaştır">
        <i class="fas fa-plus"></i>
    </button>
    <div class="zoom-value" id="zoomValue">250%</div>
    <button class="zoom-btn" onclick="toggleZoomControls()" title="Kapat">
        <i class="fas fa-times"></i>
    </button>
</div>

<!-- RIGHT CLICK CONTEXT MENU -->
<div class="context-menu" id="contextMenu">
    <div class="context-menu-item" onclick="contextMenuAction('copy')">
        <i class="fas fa-copy"></i>
        <span>Kopyala</span>
    </div>
    <div class="context-menu-item" onclick="contextMenuAction('selectAll')">
        <i class="fas fa-select-all"></i>
        <span>Tümünü Seç</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" onclick="contextMenuAction('zoomIn')">
        <i class="fas fa-search-plus"></i>
        <span>Yakınlaştır</span>
    </div>
    <div class="context-menu-item" onclick="contextMenuAction('zoomOut')">
        <i class="fas fa-search-minus"></i>
        <span>Uzaklaştır</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" onclick="contextMenuAction('rotateLeft')">
        <i class="fas fa-undo"></i>
        <span>Sola Döndür</span>
    </div>
    <div class="context-menu-item" onclick="contextMenuAction('rotateRight')">
        <i class="fas fa-redo"></i>
        <span>Sağa Döndür</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" onclick="contextMenuAction('fullscreen')">
        <i class="fas fa-expand"></i>
        <span>Tam Ekran</span>
    </div>
    <div class="context-menu-item" onclick="contextMenuAction('printPage')">
        <i class="fas fa-print"></i>
        <span>Yazdır</span>
    </div>
    <div class="context-menu-separator"></div>
    <div class="context-menu-item" onclick="contextMenuAction('saveImage')">
        <i class="fas fa-download"></i>
        <span>Resim Olarak Kaydet</span>
    </div>
</div>

<!-- Theme Selection Popup -->
<div class="theme-popup" id="themePopup">
    <div class="theme-popup-content">
        <div class="theme-popup-header">
            <h2 class="theme-popup-title">Tema Seç</h2>
            <button class="theme-close-btn" onclick="hideThemePopup()">&times;</button>
        </div>

        <div class="theme-grid">
            <div class="theme-option active" data-theme="default" onclick="selectTheme('default')" title="Varsayılan"></div>
            <div class="theme-option" data-theme="forest" onclick="selectTheme('forest')" title="Orman"></div>
            <div class="theme-option" data-theme="sunset" onclick="selectTheme('sunset')" title="Gün Batımı"></div>
            <div class="theme-option" data-theme="ocean" onclick="selectTheme('ocean')" title="Okyanus"></div>
            <div class="theme-option" data-theme="purple" onclick="selectTheme('purple')" title="Mor"></div>
            <div class="theme-option" data-theme="dark" onclick="selectTheme('dark')" title="Karanlık"></div>
            <div class="theme-option" data-theme="golden" onclick="selectTheme('golden')" title="Altın"></div>
            <div class="theme-option" data-theme="emerald" onclick="selectTheme('emerald')" title="Zümrüt"></div>
            <div class="theme-option" data-theme="crimson" onclick="selectTheme('crimson')" title="Kızıl"></div>
            <div class="theme-option" data-theme="royal" onclick="selectTheme('royal')" title="Kraliyet"></div>
        </div>

        <div class="custom-theme-section">
            <h3 class="custom-theme-title">Özel Tema</h3>
            <div class="custom-theme-controls">
                <div class="color-input-group">
                    <label class="color-input-label">Başlık</label>
                    <input type="color" class="color-input" id="headerColor" value="#2c3e50">
                </div>
                <div class="color-input-group">
                    <label class="color-input-label">Vurgu</label>
                    <input type="color" class="color-input" id="accentColor" value="#3498db">
                </div>
                <button class="apply-custom-theme" onclick="applyCustomTheme()">Özel Temayı Uygula</button>
            </div>
        </div>
    </div>
</div>

<!-- Info Popup -->
<div class="info-popup" id="infoPopup">
    <div class="info-content">
        <div class="popup-header">
            <h2 class="popup-title">Kur'an-ı Kerim (Arapça & Türkçe Meal)</h2>
            <button class="theme-close-btn" onclick="hideInfoPopup()">&times;</button>
        </div>
<div class="popup-content-scrollable">
    <div class="popup-text">
        Kur'an-ı Kerim, İslam Dini'nin Kutsal Kitabı'dır ve Allah'ın Peygamber Muhammed (sav) aracılığıyla insanlığa gönderdiği son vahiydir. Bu dijital mushaf uygulaması, hem Arapça metni hem de Türkçe meal ile birlikte sunulmuştur.
    </div>
    <div class="popup-text">
        Kur'an-ı Kerim, 114 sureden ve toplam 6236 ayetten oluşmaktadır. Bu aplikasyon, tüm surelerin ve cüzlerin sistematik bir şekilde düzenlenmiş halini sunmaktadır.
    </div>
    <h3 style="color: var(--accent-color); margin: 20px 0 15px 0; font-size: 1.3rem;">Özellikler</h3>
    <div class="popup-text">
        <strong>• Tam Kur'an Metni:</strong> 605 sayfa olup, yüksek kaliteli Arapça metin ve Türkçe meal<br><br>
        <strong>• Sure ve Cüz Navigasyonu:</strong> Tüm 114 sure ve 30 cüz için detaylı yer imleri<br><br>
        <strong>• Gelişmiş Okuma Deneyimi:</strong> Yakınlaştırma, sayfa döndürme ve otomatik kaydırma özellikleri<br><br>
        <strong>• Not Alma Sistemi:</strong> Ayetler üzerine not alma ve işaretleme imkanı<br><br>
        <strong>• Çoklu Tema Desteği:</strong> Farklı okuma ortamları için çeşitli tema seçenekleri
    </div>
    <div class="popup-text">
        Bu uygulama, Kur'an-ı Kerim'i dijital ortamda okuma ve çalışma deneyimini en üst düzeye çıkarmak için tasarlanmıştır.
    </div>
    <div class="popup-text" style="background: rgba(52, 152, 219, 0.1); padding: 15px; border-radius: 8px; border-left: 4px solid var(--accent-color); margin: 20px 0; font-weight: 600;">
        Bu uygulama BOLT.NEW sayesinde BELGESELSEMO tarafından hazırlanmıştır.
    </div>
</div>
        <div class="popup-footer">
            BELGESELSEMO.COM.TR
        </div>
    </div>
</div>

<!-- Hotkey Popup -->
<div class="hotkey-popup" id="hotkeyPopup">
    <div class="hotkey-content">
        <div class="popup-header">
            <h2 class="popup-title">Klavye Kısayolları</h2>
            <button class="theme-close-btn" onclick="hideHotkeyPopup()">&times;</button>
        </div>
        <div class="popup-content-scrollable">
            <table class="hotkey-table">
                <thead>
                <tr>
                    <th>İşlem</th>
                    <th>Kısayol</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>Önceki Sayfa</td>
                    <td><span class="hotkey-key">←</span> veya <span class="hotkey-key">PageUp</span></td>
                </tr>
                <tr>
                    <td>Sonraki Sayfa</td>
                    <td><span class="hotkey-key">→</span> veya <span class="hotkey-key">PageDown</span></td>
                </tr>
                <tr>
                    <td>İlk Sayfa</td>
                    <td><span class="hotkey-key">Home</span></td>
                </tr>
                <tr>
                    <td>Son Sayfa</td>
                    <td><span class="hotkey-key">End</span></td>
                </tr>
                <tr>
                    <td>Yakınlaştır</td>
                    <td><span class="hotkey-key">+</span> veya <span class="hotkey-key">Ctrl + Mouse Wheel</span></td>
                </tr>
                <tr>
                    <td>Uzaklaştır</td>
                    <td><span class="hotkey-key">-</span> veya <span class="hotkey-key">Ctrl + Mouse Wheel</span></td>
                </tr>
                <tr>
                    <td>Saat yönünde döndür</td>
                    <td><span class="hotkey-key">R</span></td>
                </tr>
                <tr>
                    <td>Saat yönünün tersine döndür</td>
                    <td><span class="hotkey-key">L</span></td>
                </tr>
                <tr>
                    <td>Tam Ekran</td>
                    <td><span class="hotkey-key">F</span> veya <span class="hotkey-key">F11</span></td>
                </tr>
                <tr>
                    <td>Çizim araçlarını aç/kapat</td>
                    <td><span class="hotkey-key">D</span></td>
                </tr>
                <tr>
                    <td>Dikdörtgen seçim aracını aktif et</td>
                    <td><span class="hotkey-key">S</span></td>
                </tr>
                <tr>
                    <td>Lasso seçim aracını aktif et</td>
                    <td><span class="hotkey-key">L</span></td>
                </tr>
                <tr>
                    <td>Ekran alıntısı aracını aktif et</td>
                    <td><span class="hotkey-key">C</span></td>
                </tr>
                <tr>
                    <td>Sayı doğrusu aracını aktif et</td>
                    <td><span class="hotkey-key">N</span></td>
                </tr>
                <tr>
                    <td>Tüm çizimleri seç</td>
                    <td><span class="hotkey-key">Ctrl+A</span></td>
                </tr>
                <tr>
                    <td>Seçili çizimleri sil</td>
                    <td><span class="hotkey-key">Delete</span></td>
                </tr>
                <tr>
                    <td>Seçili alanı taşı</td>
                    <td><span class="hotkey-key">Sürükle</span></td>
                </tr>
                <tr>
                    <td>Seçili alanı döndür</td>
                    <td><span class="hotkey-key">Döndürme Handle'ı</span></td>
                </tr>
                <tr>
                    <td>Seçili alanı boyutlandır</td>
                    <td><span class="hotkey-key">Köşe Handle'ları</span></td>
                </tr>
                <tr>
                    <td>Orantılı boyutlandırma</td>
                    <td><span class="hotkey-key">Shift + Sürükle</span></td>
                </tr>
                <tr>
                    <td>15° artışlarla döndürme</td>
                    <td><span class="hotkey-key">Ctrl + Döndür</span></td>
                </tr>
                <tr>
                    <td>Açık paneli kapat</td>
                    <td><span class="hotkey-key">Esc</span></td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="popup-footer">
            BELGESELSEMO.COM.TR
        </div>
    </div>
</div>

<!-- Search Modal -->
<div class="modal-overlay" id="searchModal">
    <div class="modal-content">
        <div class="theme-popup-header">
            <h2 class="theme-popup-title">PDF'de Ara</h2>
            <button class="theme-close-btn" onclick="closeSearchModal()">&times;</button>
        </div>
        <div style="margin-bottom: 20px;">
            <input type="text" style="width: 100%; padding: 12px; border: 2px solid rgba(255, 255, 255, 0.3); border-radius: 8px; background: rgba(255, 255, 255, 0.1); color: white; font-size: 14px; outline: none;" id="searchInput" placeholder="Aramak istediğiniz kelime veya cümleyi yazın..." onkeypress="handleSearchKeyPress(event)">
        </div>
        <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="performSearch()">
                <i class="fas fa-search"></i> Ara
            </button>
            <button class="btn btn-secondary" onclick="findNext()">
                <i class="fas fa-arrow-down"></i> Sonraki
            </button>
            <button class="btn btn-secondary" onclick="findPrevious()">
                <i class="fas fa-arrow-up"></i> Önceki
            </button>
            <button class="btn btn-outline" onclick="clearSearch()">
                <i class="fas fa-times"></i> Temizle
            </button>
        </div>
        <div id="searchResults" style="display: none; max-height: 200px; overflow-y: auto; margin-top: 15px; padding: 10px; background: rgba(255, 255, 255, 0.1); border-radius: 8px;">
            <!-- Search results will be populated here -->
        </div>
    </div>
</div>

<!-- Enhanced URL Popup -->
<div class="popup-overlay hidden" id="popupOverlay">
    <div class="popup-content url-input-popup" id="popupContent">
        <div class="popup-header">
            <div class="popup-title">PDF URL'si Girin</div>
            <button class="popup-close" onclick="closePopup()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <input type="url" class="url-input" id="urlInput" placeholder="https://example.com/document.pdf" autocomplete="off" spellcheck="false">
        <div class="url-loading hidden" id="urlLoading">
            <div class="loading-spinner"></div>
            <div class="url-loading-text" id="urlLoadingText">URL analiz ediliyor...</div>
            <div class="url-progress">
                <div class="url-progress-bar" id="urlProgressBar"></div>
            </div>
        </div>
        <div class="url-status hidden" id="urlStatus">
            <div class="url-status-icon">
                <i class="fas fa-info-circle"></i>
            </div>
            <div class="url-status-text" id="urlStatusText"></div>
        </div>
        <div class="popup-buttons">
            <button class="popup-button secondary" onclick="closePopup()">İptal</button>
            <button class="popup-button primary" onclick="loadFromUrl()">Yükle</button>
        </div>
    </div>
</div>

<!-- Recent Files Modal -->
<div class="recent-files-modal" id="recentFilesModal">
    <div class="recent-files-content">
        <div class="recent-files-header">
            <h2 class="recent-files-title">Son Açılan PDF Dosyaları</h2>
            <button class="theme-close-btn" onclick="hideRecentFiles()">&times;</button>
        </div>
        <div class="recent-files-list" id="recentFilesList">
            <!-- Recent files will be populated here -->
        </div>
        <button class="clear-recent-btn" onclick="clearRecentFiles()">
            <i class="fas fa-trash"></i> Tüm Listeyi Temizle
        </button>
    </div>
</div>

<!-- Notes Modal -->
<div class="notes-modal" id="notesModal" onclick="hideNotesModal()">
    <div class="notes-container" onclick="event.stopPropagation()">
        <div class="notes-header">
            <h2 class="notes-title">
                <i class="fas fa-sticky-note" style="color: var(--accent-color);"></i>
                Not Listesi
            </h2>
            <button class="notes-close" onclick="hideNotesModal()" title="Kapat">
                <i class="fas fa-times"></i>
            </button>
        </div>

        <div class="add-note-section">
            <div class="note-input-controls">
                <select class="note-category-select" id="noteCategory">
                    <option value="genel">📝 Genel</option>
                    <option value="onemli">⭐ Önemli</option>
                    <option value="calisma">📚 Çalışma</option>
                    <option value="is">💼 İş</option>
                </select>
                <button class="note-priority-btn" id="notePriority" onclick="toggleNotePriority()" title="Favori olarak işaretle">
                    <i class="fas fa-star"></i> Favori
                </button>
            </div>
            <div style="margin: 15px 0;"></div>
            <textarea
                    class="add-note-input"
                    id="noteInput"
                    placeholder="Yeni notunuzu buraya yazın..."
                    rows="4"
            ></textarea>
            <button class="add-note-btn" onclick="addNote()">
                <i class="fas fa-plus"></i>
                Not Ekle
            </button>
        </div>

        <div class="notes-list" id="notesList">
            <!-- Notes will be populated here -->
        </div>
    </div>
</div>

<!-- Bookmarks Panel -->
<div class="bookmarks-panel" id="bookmarksPanel">
    <div class="bookmarks-header">Yer İmleri</div>
    <div class="bookmarks-list" id="bookmarksList">
        <div style="color: rgba(255,255,255,0.5); text-align: center; padding: 20px;">
            Henüz yer imi eklenmemiş
        </div>
    </div>
</div>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
        <div class="loading-spinner"></div>
        <h3>PDF Araçları işlevsizdir...</h3>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <p id="loadingText">Yükleniyor...</p>
    </div>
</div>

<!-- Toast Container -->
<div class="toast" id="toast"></div>

<!-- Clipboard Overlay -->
<div class="clipboard-overlay" id="clipboardOverlay">
    <div style="font-size: 18px; margin-bottom: 10px;">
        <i class="fas fa-clipboard-check" style="margin-right: 10px; color: var(--accent-color);"></i>
        Panoya Kopyalandı!
    </div>
    <div style="font-size: 14px; opacity: 0.8;">
        Ctrl+V ile istediğiniz yere yapıştırabilirsiniz
    </div>
</div>

<!-- Enhanced Thumbnail Panel - TÜM SAYFALAR İÇİN LAZY LOADING -->
<div class="thumbnail-panel" id="thumbnailPanel">
    <div class="thumbnail-header">
        <div>
            <i class="fas fa-th-large" style="margin-right: 10px;"></i>
            Sayfa Önizlemeleri (605 Sayfa)
        </div>
        <button class="thumbnail-close-btn" onclick="closeThumbnailPanel()" title="Kapat">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="thumbnail-grid" id="thumbnailGrid">
        <!-- Thumbnails will be generated here with lazy loading -->
    </div>
    <div class="thumbnail-footer">
        BELGESELSEMO.COM.TR - Lazy Loading ile tüm 605 sayfa önizlemesi
    </div>
</div>

<!-- Hidden File Input -->
<input type="file" id="fileInput" accept=".pdf" style="display: none;" onchange="handleFileSelect(event)">

<script>
    // Global Variables
    let currentPage = 1;
    let totalPages = 605; // Toplam sayfa sayısı 605 olarak değiştirildi
    let scale = 2.5; // Default desktop scale
    let rotation = 0;
    let pageCache = new Map();
    let visiblePageObserver = null;
    let searchResults = [];
    let searchCache = new Map();
    let searchWorker = null;
    let notes = [];
    let currentSearchIndex = -1;
    let currentTheme = 'default';
    let bookmarks = [];
    let recentFiles = [];

    // ENHANCED Auto-scroll variables - PÜRÜZSÜZ KAYDIRMA İÇİN
    let isAutoScrolling = false;
    let autoScrollInterval = null;
    let scrollSpeed = 3;
    let smoothScrollFrame = null; // requestAnimationFrame için

    // ULTRA ENHANCED Drawing variables
    let isDrawingMode = false;
    let isDrawing = false;
    let currentTool = 'pen';
    let currentColor = '#ff0000';
    let brushSize = 1;
    let currentOpacity = 100;
    let drawingCanvases = new Map();
    let drawingContexts = new Map();
    let undoStack = {};
    let redoStack = {};
    let selectedDrawings = new Set();
    let copiedDrawings = [];
    let isGridEnabled = false;
    let isSnapEnabled = false;
    let measurements = new Map();
    let textEditors = new Map();
    let numberLines = new Map();

    // ULTRA ENHANCED SELECTION AND MANIPULATION VARIABLES
    let activeSelections = new Map();
    let isSelecting = false;
    let selectionStart = null;
    let highlights = new Map();
    let isManipulating = false;
    let manipulationData = null;
    let manipulationStartPos = null;
    let manipulationStartSize = null;
    let manipulationStartRotation = 0;
    let currentManipulationHandle = null;

    let manipulationCanvas = null;
    let capturedImageData = null;
    let originalCanvasState = null;
    let isFlippedHorizontal = false;
    let isFlippedVertical = false;
    let currentRotation = 0;

    // Toolbar dragging variables
    let isDraggingToolbar = false;
    let toolbarDragOffset = { x: 0, y: 0 };

    // Current file info for recent files
    let currentFileInfo = null;

    // Performance optimization variables
    let lastRenderTime = 0;
    let renderQueue = [];
    let isRendering = false;

    // PERSISTENT DRAWINGS STORAGE
    let persistentDrawings = new Map(); // pageNum -> imageData

    // ENHANCED COPY/PASTE SYSTEM FOR DRAWINGS
    let clipboardData = null;
    let allPageDrawings = new Map(); // pageNum -> drawings array

    // ENHANCED MEASUREMENT SYSTEM
    let measurementPoints = [];
    let currentMeasurement = null;
    let activeMeasurements = new Map();

    // BASE URL FOR IMAGES - UPDATED
    const BASE_IMAGE_URL = 'https://kurani-kerim-belgeselsemo.netlify.app/files/mobile/';

    // PREDEFINED BOOKMARKS FROM TEXT FILE - UPDATED WITH QURAN SURAHS AND JUZS
    const predefinedBookmarks = [
        // Sureler
        {
            title: 'FATİHA SURESİ',
            pageNum: 1,
            level: 0
        },
        {
            title: 'BAKARA SURESİ',
            pageNum: 2,
            level: 0
        },
        {
            title: 'AL-İ İMRAN SURESİ',
            pageNum: 50,
            level: 0
        },
        {
            title: 'NİSA SURESİ',
            pageNum: 77,
            level: 0
        },
        {
            title: 'MAİDE SURESİ',
            pageNum: 106,
            level: 0
        },
        {
            title: 'EN\'AM SURESİ',
            pageNum: 128,
            level: 0
        },
        {
            title: 'ARAF SURESİ',
            pageNum: 151,
            level: 0
        },
        {
            title: 'ENFAL SURESİ',
            pageNum: 177,
            level: 0
        },
        {
            title: 'TEVBE SURESİ',
            pageNum: 187,
            level: 0
        },
        {
            title: 'YUNUS SURESİ',
            pageNum: 208,
            level: 0
        },
        {
            title: 'HUD SURESİ',
            pageNum: 221,
            level: 0
        },
        {
            title: 'YUSUF SURESİ',
            pageNum: 235,
            level: 0
        },
        {
            title: 'RAD SURESİ',
            pageNum: 249,
            level: 0
        },
        {
            title: 'İBRAHİM SURESİ',
            pageNum: 255,
            level: 0
        },
        {
            title: 'HİCR SURESİ',
            pageNum: 262,
            level: 0
        },
        {
            title: 'NAHL SURESİ',
            pageNum: 267,
            level: 0
        },
        {
            title: 'İSRA SURESİ',
            pageNum: 282,
            level: 0
        },
        {
            title: 'KEHF SURESİ',
            pageNum: 293,
            level: 0
        },
        {
            title: 'MERYEM SURESİ',
            pageNum: 305,
            level: 0
        },
        {
            title: 'TAHA SURESİ',
            pageNum: 312,
            level: 0
        },
        {
            title: 'ENBİYA SURESİ',
            pageNum: 322,
            level: 0
        },
        {
            title: 'HACC SURESİ',
            pageNum: 332,
            level: 0
        },
        {
            title: 'MUMİNUN SURESİ',
            pageNum: 342,
            level: 0
        },
        {
            title: 'NUR SURESİ',
            pageNum: 350,
            level: 0
        },
        {
            title: 'FURKAN SURESİ',
            pageNum: 359,
            level: 0
        },
        {
            title: 'ŞUARA SURESİ',
            pageNum: 367,
            level: 0
        },
        {
            title: 'NEML SURESİ',
            pageNum: 377,
            level: 0
        },
        {
            title: 'KASSAS SURESİ',
            pageNum: 385,
            level: 0
        },
        {
            title: 'ANKEBUT SURESİ',
            pageNum: 396,
            level: 0
        },
        {
            title: 'RUM SURESİ',
            pageNum: 404,
            level: 0
        },
        {
            title: 'LOKMAN SURESİ',
            pageNum: 411,
            level: 0
        },
        {
            title: 'SECDE SURESİ',
            pageNum: 415,
            level: 0
        },
        {
            title: 'AHZAB SURESİ',
            pageNum: 418,
            level: 0
        },
        {
            title: 'SEBE\' SURESİ',
            pageNum: 428,
            level: 0
        },
        {
            title: 'FATIR SURESİ',
            pageNum: 434,
            level: 0
        },
        {
            title: 'YASİN SURESİ',
            pageNum: 440,
            level: 0
        },
        {
            title: 'SAFFAT SURESİ',
            pageNum: 446,
            level: 0
        },
        {
            title: 'SAD SURESİ',
            pageNum: 453,
            level: 0
        },
        {
            title: 'ZİMER SURESİ',
            pageNum: 458,
            level: 0
        },
        {
            title: 'MÜMİN SURESİ',
            pageNum: 467,
            level: 0
        },
        {
            title: 'FUSSİLET SURESİ',
            pageNum: 477,
            level: 0
        },
        {
            title: 'ŞURA SURESİ',
            pageNum: 483,
            level: 0
        },
        {
            title: 'ZUHRUF SURESİ',
            pageNum: 489,
            level: 0
        },
        {
            title: 'DUHAN SURESİ',
            pageNum: 496,
            level: 0
        },
        {
            title: 'GASİYE SURESİ',
            pageNum: 499,
            level: 0
        },
        {
            title: 'AHKAF SURESİ',
            pageNum: 502,
            level: 0
        },
        {
            title: 'MUHAMMED SURESİ',
            pageNum: 507,
            level: 0
        },
        {
            title: 'FETİH SURESİ',
            pageNum: 511,
            level: 0
        },
        {
            title: 'HUCURAT SURESİ',
            pageNum: 515,
            level: 0
        },
        {
            title: 'KAF SURESİ',
            pageNum: 518,
            level: 0
        },
        {
            title: 'ZARİYAT SURESİ',
            pageNum: 520,
            level: 0
        },
        {
            title: 'TUR SURESİ',
            pageNum: 523,
            level: 0
        },
        {
            title: 'NECM SURESİ',
            pageNum: 526,
            level: 0
        },
        {
            title: 'KAMER SURESİ',
            pageNum: 528,
            level: 0
        },
        {
            title: 'RAHMAN SURESİ',
            pageNum: 531,
            level: 0
        },
        {
            title: 'VAKIA SURESİ',
            pageNum: 534,
            level: 0
        },
        {
            title: 'HADİD SURESİ',
            pageNum: 537,
            level: 0
        },
        {
            title: 'MİCADELE SURESİ',
            pageNum: 542,
            level: 0
        },
        {
            title: 'HAŞR SURESİ',
            pageNum: 545,
            level: 0
        },
        {
            title: 'MİMTAHİNE SURESİ',
            pageNum: 549,
            level: 0
        },
        {
            title: 'SAFF SURESİ',
            pageNum: 551,
            level: 0
        },
        {
            title: 'CUMA SURESİ',
            pageNum: 553,
            level: 0
        },
        {
            title: 'MİNAFİKUN SURESİ',
            pageNum: 554,
            level: 0
        },
        {
            title: 'TEGABİN SURESİ',
            pageNum: 556,
            level: 0
        },
        {
            title: 'TALAK SURESİ',
            pageNum: 558,
            level: 0
        },
        {
            title: 'TAHRİM SURESİ',
            pageNum: 560,
            level: 0
        },
        {
            title: 'MİLK SURESİ',
            pageNum: 562,
            level: 0
        },
        {
            title: 'KALEM SURESİ',
            pageNum: 564,
            level: 0
        },
        {
            title: 'HAKKA SURESİ',
            pageNum: 566,
            level: 0
        },
        {
            title: 'MEARÎC SURESİ',
            pageNum: 568,
            level: 0
        },
        {
            title: 'NUH SURESİ',
            pageNum: 570,
            level: 0
        },
        {
            title: 'CİNN SURESİ',
            pageNum: 572,
            level: 0
        },
        {
            title: 'MİZZEMMİL SURESİ',
            pageNum: 574,
            level: 0
        },
        {
            title: 'MİDDESSİR SURESİ',
            pageNum: 575,
            level: 0
        },
        {
            title: 'KIYAMET SURESİ',
            pageNum: 577,
            level: 0
        },
        {
            title: 'İNSAN SURESİ',
            pageNum: 578,
            level: 0
        },
        {
            title: 'MİRSELAT SURESİ',
            pageNum: 580,
            level: 0
        },
        {
            title: 'NEBE\' SURESİ',
            pageNum: 582,
            level: 0
        },
        {
            title: 'NAZİ\'AT SURESİ',
            pageNum: 583,
            level: 0
        },
        {
            title: 'ABESE SURESİ',
            pageNum: 585,
            level: 0
        },
        {
            title: 'TEKVİR SURESİ',
            pageNum: 586,
            level: 0
        },
        {
            title: 'İNFİTAR SURESİ',
            pageNum: 587,
            level: 0
        },
        {
            title: 'MUTAFFİFİN SURESİ',
            pageNum: 588,
            level: 0
        },
        {
            title: 'İNŞİKAK SURESİ',
            pageNum: 589,
            level: 0
        },
        {
            title: 'BİRÛC SURESİ',
            pageNum: 590,
            level: 0
        },
        {
            title: 'TARIK SURESİ',
            pageNum: 591,
            level: 0
        },
        {
            title: 'GAŞİYE SURESİ',
            pageNum: 592,
            level: 0
        },
        {
            title: 'FECR SURESİ',
            pageNum: 593,
            level: 0
        },
        {
            title: 'BELED SURESİ',
            pageNum: 594,
            level: 0
        },
        {
            title: 'ŞEMS SURESİ',
            pageNum: 595,
            level: 0
        },
        {
            title: 'LEYL-DUHA SURESİ',
            pageNum: 596,
            level: 0
        },
        {
            title: 'İNŞİRAH-TİN SURESİ',
            pageNum: 597,
            level: 0
        },
        {
            title: 'ALAK SURESİ',
            pageNum: 598,
            level: 0
        },
        {
            title: 'BEYYİNE SURESİ',
            pageNum: 599,
            level: 0
        },
        {
            title: 'ZİLZAL-ADİYAT SURESİ',
            pageNum: 600,
            level: 0
        },
        {
            title: 'KARİ\'A-TEKASİR SURESİ',
            pageNum: 601,
            level: 0
        },
        {
            title: 'ASR-HÜMEZE-FİL SURESİ',
            pageNum: 602,
            level: 0
        },
        {
            title: 'KUREYŞ-MAÛN-KEVSER SURESİ',
            pageNum: 603,
            level: 0
        },
        {
            title: 'KAFİRUN-NASR-TEBBET SURESİ',
            pageNum: 604,
            level: 0
        },
        {
            title: 'İHLAS-FELAK-NAS SURESİ',
            pageNum: 605,
            level: 0
        }
    ];

    // ENHANCED THUMBNAIL LAZY LOADING VARIABLES
    let thumbnailObserver = null;
    let thumbnailLoadQueue = [];
    let thumbnailsLoaded = new Set();
    let thumbnailBatchSize = 20; // Her seferde yüklenecek thumbnail sayısı

    // DEVICE DETECTION AND ZOOM SETUP
    function isMobileDevice() {
        return window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    function setInitialZoom() {
        if (isMobileDevice()) {
            scale = 1.02;
            document.getElementById('zoomSlider').value = 102;
            document.getElementById('zoomValue').textContent = '102%';
            showToast('Mobil cihaz tespit edildi - Zoom %102 olarak ayarlandı', 'info');
        } else {
            scale = 2.5;
            document.getElementById('zoomSlider').value = 250;
            document.getElementById('zoomValue').textContent = '250%';
            showToast('Masaüstü cihaz tespit edildi - Zoom %250 olarak ayarlandı', 'info');
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        initializeEventListeners();
        loadRecentFiles();
        updatePageInfo();
        setupToolbarDragging();
        setInitialZoom();
        
        // OTOMATIK OLARAK RESİMLERİ YÜKLEYİN
        setTimeout(() => {
            autoLoadImages();
        }, 500);
        
        showToast('Kur\'an-ı Kerim Arapça & Türkçe Mealli Enhanced Edition hazır! Kur\'an-ı Kerim yükleniyor...', 'success');
    });

    // OTOMATIK RESİM YÜKLEME FONKSİYONU
    async function autoLoadImages() {
        showLoading('Kur\'an-ı Kerim yükleniyor...', 0);
        
        try {
            // Set up current file info
            currentFileInfo = {
                name: 'Kur\'an-ı Kerim Arapça & Türkçe Mealli',
                pages: totalPages,
                url: BASE_IMAGE_URL,
                lastPage: 1
            };

            // Set up bookmarks
            bookmarks = [...predefinedBookmarks];
            displayBookmarks();

            // Render all pages
            await renderAllPagesAsImages();
            showPDFContainer();
            
            // Add to recent files
            addToRecentFiles(currentFileInfo.name, totalPages, BASE_IMAGE_URL, 1);

            hideLoading();
            showToast(`Kur\'an-ı Kerim başarıyla yüklendi! (${totalPages} sayfa)`, 'success');

        } catch (error) {
            hideLoading();
            showToast('Sayfalar yüklenirken hata oluştu!', 'error');
            console.error('Auto loading error:', error);
        }
    }

    // RESİMLERİ SAYFA OLARAK RENDER ETME
    async function renderAllPagesAsImages() {
        const container = document.getElementById('pdfContainer');
        container.innerHTML = '';

        for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
            const pageDiv = document.createElement('div');
            pageDiv.className = 'pdf-page';
            pageDiv.setAttribute('data-page-num', pageNum);

            const placeholder = document.createElement('div');
            placeholder.className = 'loading-placeholder';
            placeholder.innerHTML = `
                <div style="font-size: 18px; font-weight: bold; margin-bottom: 10px;">
                    <i class="fas fa-image" style="color: #e74c3c; margin-right: 8px;"></i>
                    Sayfa ${pageNum}
                </div>
                <div style="font-size: 14px; margin-bottom: 15px; opacity: 0.8;">Ultra HD kalitede yüklemek için tıklayın</div>
                <button class="retry-btn" onclick="loadImagePageNow(${pageNum})">
                    <i class="fas fa-download" style="margin-right: 6px;"></i>
                    Yükle
                </button>
            `;
            pageDiv.appendChild(placeholder);

            container.appendChild(pageDiv);

            updateProgress(Math.round((pageNum / totalPages) * 50));
        }

        setupPageObserver();
        await renderInitialImagePages();

        updatePageInfo();
        adjustPDFPagesToViewport();
    }

    async function renderInitialImagePages() {
        const initialPagesToRender = Math.min(5, totalPages);

        for (let pageNum = 1; pageNum <= initialPagesToRender; pageNum++) {
            await loadImagePageNow(pageNum);
        }
    }

    async function loadImagePageNow(pageNum) {
        const pageDiv = document.querySelector(`[data-page-num="${pageNum}"]`);
        if (!pageDiv) return;

        if (pageDiv.querySelector('img')) {
            return;
        }

        const placeholder = pageDiv.querySelector('.loading-placeholder');
        if (placeholder) {
            placeholder.innerHTML = `
                <div style="font-size: 16px; color: var(--accent-color);">
                    <i class="fas fa-spinner fa-spin" style="margin-right: 8px;"></i>
                    Sayfa ${pageNum} Ultra HD kalitede yükleniyor...
                </div>
            `;
        }

        try {
            const imageUrl = BASE_IMAGE_URL + pageNum + '.jpg';
            
            // Create image element
            const img = document.createElement('img');
            img.src = imageUrl;
            img.alt = `Sayfa ${pageNum}`;
            img.style.width = '100%';
            img.style.height = 'auto';
            img.style.maxWidth = '100%';
            img.style.borderRadius = '4px';

            // Wait for image to load
            await new Promise((resolve, reject) => {
                img.onload = () => {
                    if (pageDiv.parentNode) {
                        pageDiv.innerHTML = '';
                        pageDiv.appendChild(img);

                        if (isDrawingMode) {
                            createDrawingCanvas(pageDiv, pageNum);
                        }

                        // RESTORE PERSISTENT DRAWINGS
                        if (persistentDrawings.has(pageNum)) {
                            const drawingCanvas = drawingCanvases.get(pageNum);
                            const ctx = drawingContexts.get(pageNum);
                            if (drawingCanvas && ctx) {
                                const imgData = new Image();
                                imgData.onload = () => {
                                    ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
                                    ctx.drawImage(imgData, 0, 0);
                                };
                                imgData.src = persistentDrawings.get(pageNum);
                            }
                        }

                        if (isGridEnabled) {
                            const gridOverlay = document.createElement('div');
                            gridOverlay.className = 'grid-overlay show';
                            pageDiv.appendChild(gridOverlay);
                        }

                        if (highlights.has(pageNum)) {
                            highlights.get(pageNum).forEach(highlight => {
                                addHighlightOverlay(pageDiv, highlight);
                            });
                        }

                        adjustSinglePageToViewport(pageDiv);

                        img.style.opacity = '0';
                        img.style.transform = 'scale(0.95)';
                        setTimeout(() => {
                            img.style.transition = 'all 0.3s ease';
                            img.style.opacity = '1';
                            img.style.transform = 'scale(1)';
                        }, 50);
                    }
                    resolve();
                };
                
                img.onerror = () => {
                    reject(new Error(`Failed to load image: ${imageUrl}`));
                };
            });

        } catch (error) {
            console.error(`Failed to load page ${pageNum}:`, error);
            if (placeholder) {
                placeholder.innerHTML = `
                    <div style="color: #e74c3c; font-size: 16px; margin-bottom: 10px;">
                        <i class="fas fa-exclamation-triangle" style="margin-right: 8px;"></i>
                        Sayfa ${pageNum} yüklenemedi
                    </div>
                    <button class="retry-btn" onclick="loadImagePageNow(${pageNum})">
                        <i class="fas fa-redo" style="margin-right: 6px;"></i>
                        Tekrar Dene
                    </button>
                `;
            }
        }
    }

    function setupPageObserver() {
        if (visiblePageObserver) {
            visiblePageObserver.disconnect();
        }

        visiblePageObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const pageNum = parseInt(entry.target.getAttribute('data-page-num'));

                    loadImagePageNow(pageNum);

                    const preloadRange = 2;
                    for (let i = Math.max(1, pageNum - preloadRange);
                         i <= Math.min(totalPages, pageNum + preloadRange); i++) {
                        if (i !== pageNum) {
                            setTimeout(() => loadImagePageNow(i), (Math.abs(i - pageNum) * 200));
                        }
                    }
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '300px'
        });

        document.querySelectorAll('.pdf-page').forEach(page => {
            visiblePageObserver.observe(page);
        });
    }

    function displayBookmarks() {
        const bookmarksList = document.getElementById('bookmarksList');

        if (bookmarks.length === 0) {
            bookmarksList.innerHTML = `
                <div style="color: rgba(255,255,255,0.5); text-align: center; padding: 30px; font-size: 16px;">
                    <i class="fas fa-bookmark" style="font-size: 48px; margin-bottom: 15px; display: block; opacity: 0.3;"></i>
                    Yer imi bulunamadı
                </div>
            `;
            return;
        }

        bookmarksList.innerHTML = '';

        bookmarks.forEach((bookmark, index) => {
            const bookmarkItem = document.createElement('div');
            bookmarkItem.className = 'bookmark-item';
            bookmarkItem.style.paddingLeft = (bookmark.level * 20 + 15) + 'px';
            bookmarkItem.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 6px; font-size: 15px; line-height: 1.3;">
                    <i class="fas fa-bookmark" style="margin-right: 8px; color: var(--accent-color); font-size: 12px;"></i>
                    ${bookmark.title}
                </div>
                <div style="font-size: 13px; color: var(--accent-color); font-weight: 600;">
                    <i class="fas fa-file-alt" style="margin-right: 4px;"></i>
                    Sayfa ${bookmark.pageNum}
                </div>
            `;

            bookmarkItem.onclick = () => {
                goToPage(bookmark.pageNum);
                if (window.innerWidth <= 768) {
                    toggleBookmarks();
                }
                showToast(`"${bookmark.title}" - Sayfa ${bookmark.pageNum}`, 'info');
            };

            bookmarksList.appendChild(bookmarkItem);
        });
    }

    function adjustPDFPagesToViewport() {
        document.querySelectorAll('.pdf-page').forEach(pageDiv => {
            adjustSinglePageToViewport(pageDiv);
        });
    }

    function adjustSinglePageToViewport(pageDiv) {
        const img = pageDiv.querySelector('img');
        if (!img) return;

        // Mobile detection
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

        if (isMobile) {
            // Force full width on mobile
            const containerWidth = window.innerWidth - 10;
            img.style.width = '100%';
            img.style.maxWidth = '100vw';
            img.style.height = 'auto';
            img.style.display = 'block';

            // Ensure page container is also full width
            pageDiv.style.width = '100%';
            pageDiv.style.maxWidth = '100vw';
            pageDiv.style.margin = '5px auto';
        } else {
            // Desktop behavior
            const containerWidth = document.getElementById('mainContent').clientWidth - 20;
            img.style.width = '100%';
            img.style.maxWidth = containerWidth + 'px';
            img.style.height = 'auto';
        }

        const drawingCanvas = pageDiv.querySelector('.drawing-canvas');
        if (drawingCanvas) {
            drawingCanvas.style.width = img.style.width;
            drawingCanvas.style.height = img.style.height;
        }
    }

    function updateCurrentPageFromScroll() {
        const mainContent = document.getElementById('mainContent');
        const pages = document.querySelectorAll('.pdf-page');
        const scrollTop = mainContent.scrollTop;
        const viewportHeight = mainContent.clientHeight;
        const centerY = scrollTop + viewportHeight / 2;

        let closestPage = 1;
        let closestDistance = Infinity;

        pages.forEach(page => {
            const pageTop = page.offsetTop;
            const pageHeight = page.offsetHeight;
            const pageCenter = pageTop + pageHeight / 2;
            const distance = Math.abs(centerY - pageCenter);

            if (distance < closestDistance) {
                closestDistance = distance;
                closestPage = parseInt(page.getAttribute('data-page-num'));
            }
        });

        if (closestPage !== currentPage) {
            currentPage = closestPage;
            updatePageInfo();
        }
    }

    function initializeEventListeners() {
        document.addEventListener('keydown', handleKeyboardShortcuts);
        document.addEventListener('contextmenu', handleContextMenu);
        document.addEventListener('click', (e) => {
            if (isManipulating && !e.target.closest('.selection-overlay') && !e.target.closest('.manipulation-handle')) {
                finishManipulation();
            }
        });
        document.addEventListener('dragover', handleDragOver);
        document.addEventListener('dragleave', handleDragLeave);
        document.addEventListener('drop', handleFileDrop);
        setupModalAutoClose();
        setupMobileRotationSupport();

        let resizeTimeout;
        window.addEventListener('resize', () => {
            clearTimeout(resizeTimeout);
            resizeTimeout = setTimeout(() => {
                adjustToolbarPosition();
                setInitialZoom();
                adjustPDFPagesToViewport();
                goToPage(currentPage);
            }, 250);
        });

        document.getElementById('mainContent').addEventListener('scroll', debounce(() => {
            updateCurrentPageFromScroll();
            updateLastViewedPage();
        }, 150));

        document.addEventListener('click', (e) => {
            const bookmarksPanel = document.getElementById('bookmarksPanel');
            const bookmarkIcon = document.querySelector('[onclick*="toggleBookmarks"]');

            if (bookmarksPanel.classList.contains('show') &&
                !bookmarksPanel.contains(e.target) &&
                !bookmarkIcon.contains(e.target)) {
                bookmarksPanel.classList.remove('show');
            }
        });

        document.addEventListener('click', (e) => {
            const drawingToolbar = document.getElementById('drawingToolbar');
            const drawingIcon = document.querySelector('[onclick*="toggleDrawingTools"]');

            if (drawingToolbar.classList.contains('show') &&
                !drawingToolbar.contains(e.target) &&
                !drawingIcon.contains(e.target) &&
                !e.target.closest('.pdf-page') &&
                !e.target.closest('.footer') &&
                !isDraggingToolbar) {

                if (!isDrawing && !isSelecting && !isManipulating) {
                    toggleDrawingTools();
                }
            }
        });
    }

    // Helper Functions
    function drawPolygon(ctx, centerX, centerY, radius, sides) {
        const angle = (2 * Math.PI) / sides;
        ctx.moveTo(centerX + radius * Math.cos(0), centerY + radius * Math.sin(0));
        for (let i = 1; i <= sides; i++) {
            ctx.lineTo(centerX + radius * Math.cos(i * angle), centerY + radius * Math.sin(i * angle));
        }
        ctx.stroke();
    }

    function drawStar(ctx, centerX, centerY, radius, points) {
        const outerRadius = radius;
        const innerRadius = radius * 0.4;
        const angle = Math.PI / points;

        ctx.moveTo(centerX + outerRadius * Math.cos(0), centerY + outerRadius * Math.sin(0));
        for (let i = 0; i < 2 * points; i++) {
            const r = i % 2 === 0 ? outerRadius : innerRadius;
            ctx.lineTo(centerX + r * Math.cos(i * angle), centerY + r * Math.sin(i * angle));
        }
        ctx.closePath();
        ctx.stroke();
    }

    function drawCrescent(ctx, centerX, centerY, radius) {
        ctx.save();
        const innerCenterX = centerX + radius * 0.4;
        const innerRadius = radius * 0.8;
        const d = innerCenterX - centerX;
        const x = (d * d - innerRadius * innerRadius + radius * radius) / (2 * d);
        const y = Math.sqrt(Math.max(0, radius * radius - x * x));
        const outerAngle = Math.atan2(y, x);
        const innerAngle = Math.atan2(y, x - d);

        ctx.beginPath();
        ctx.arc(centerX, centerY, radius, outerAngle, -outerAngle, false);
        ctx.arc(innerCenterX, centerY, innerRadius, -innerAngle, innerAngle, true);
        ctx.closePath();
        ctx.strokeStyle = 'red';
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.fillStyle = 'rgba(255, 182, 193, 0.8)';
        ctx.fill();
        ctx.restore();
    }

    function drawCube(ctx, x, y, width, height) {
        const depth = Math.min(width, height) * 0.3;
        ctx.strokeRect(x, y, width, height);
        ctx.strokeRect(x + depth, y - depth, width, height);
        ctx.moveTo(x, y);
        ctx.lineTo(x + depth, y - depth);
        ctx.moveTo(x + width, y);
        ctx.lineTo(x + width + depth, y - depth);
        ctx.moveTo(x, y + height);
        ctx.lineTo(x + depth, y + height - depth);
        ctx.moveTo(x + width, y + height);
        ctx.lineTo(x + width + depth, y + height - depth);
        ctx.stroke();
    }

    function drawCone(ctx, centerX, topY, bottomY, width) {
        ctx.moveTo(centerX, topY);
        ctx.lineTo(centerX - width / 2, bottomY);
        ctx.lineTo(centerX + width / 2, bottomY);
        ctx.closePath();
        ctx.ellipse(centerX, bottomY, width / 2, width / 8, 0, 0, 2 * Math.PI);
        ctx.stroke();
    }

    function drawCylinder(ctx, x, y, width, height) {
        const ellipseHeight = height * 0.1;
        ctx.ellipse(x + width / 2, y, width / 2, ellipseHeight, 0, 0, 2 * Math.PI);
        ctx.ellipse(x + width / 2, y + height, width / 2, ellipseHeight, 0, 0, 2 * Math.PI);
        ctx.moveTo(x, y);
        ctx.lineTo(x, y + height);
        ctx.moveTo(x + width, y);
        ctx.lineTo(x + width, y + height);
        ctx.stroke();
    }

    function drawTriangularPrism(ctx, x, y, width, height) {
        const depth = width * 0.3;
        ctx.moveTo(x + width / 2, y);
        ctx.lineTo(x, y + height);
        ctx.lineTo(x + width, y + height);
        ctx.closePath();
        ctx.moveTo(x + width / 2 + depth, y - depth);
        ctx.lineTo(x + depth, y + height - depth);
        ctx.lineTo(x + width + depth, y + height - depth);
        ctx.closePath();
        ctx.moveTo(x + width / 2, y);
        ctx.lineTo(x + width / 2 + depth, y - depth);
        ctx.moveTo(x, y + height);
        ctx.lineTo(x + depth, y + height - depth);
        ctx.moveTo(x + width, y + height);
        ctx.lineTo(x + width + depth, y + height - depth);
        ctx.stroke();
    }

    function drawRectangularPrism(ctx, x, y, width, height) {
        const depth = Math.min(width, height) * 0.3;
        ctx.strokeRect(x, y, width, height);
        ctx.strokeRect(x + depth, y - depth, width, height);
        ctx.moveTo(x, y);
        ctx.lineTo(x + depth, y - depth);
        ctx.moveTo(x + width, y);
        ctx.lineTo(x + width + depth, y - depth);
        ctx.moveTo(x, y + height);
        ctx.lineTo(x + depth, y + height - depth);
        ctx.moveTo(x + width, y + height);
        ctx.lineTo(x + width + depth, y + height - depth);
        ctx.stroke();
    }

    function drawNumberLine(ctx, start, end) {
        const length = Math.sqrt(Math.pow(end.x - start.x, 2) + Math.pow(end.y - start.y, 2));
        const angle = Math.atan2(end.y - start.y, end.x - start.x);

        ctx.moveTo(start.x, start.y);
        ctx.lineTo(end.x, end.y);
        ctx.stroke();

        const tickCount = Math.max(5, Math.min(20, Math.floor(length / 30)));
        const tickSpacing = length / tickCount;

        ctx.font = `${Math.max(10, brushSize + 8)}px Arial`;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'top';

        for (let i = 0; i <= tickCount; i++) {
            const tickPos = i * tickSpacing;
            const tickX = start.x + Math.cos(angle) * tickPos;
            const tickY = start.y + Math.sin(angle) * tickPos;

            const isMajor = i % 5 === 0;
            const tickHeight = isMajor ? 20 : 10;

            const perpAngle = angle + Math.PI / 2;
            ctx.moveTo(tickX - Math.cos(perpAngle) * tickHeight / 2,
                      tickY - Math.sin(perpAngle) * tickHeight / 2);
            ctx.lineTo(tickX + Math.cos(perpAngle) * tickHeight / 2,
                      tickY + Math.sin(perpAngle) * tickHeight / 2);
            ctx.stroke();

            if (isMajor) {
                const labelX = tickX + Math.cos(perpAngle) * 25;
                const labelY = tickY + Math.sin(perpAngle) * 25;
                ctx.fillText(i.toString(), labelX, labelY);
            }
        }
    }

    function showToast(message, type = 'info') {
        const toast = document.getElementById('toast');
        toast.textContent = message;
        toast.className = `toast ${type}`;
        toast.classList.add('show');

        setTimeout(() => {
            toast.classList.remove('show');
            setTimeout(() => {
                toast.style.top = '-100px';
                toast.style.opacity = '0';
                toast.style.visibility = 'hidden';
            }, 400);
        }, 4000);
    }

    // Enhanced Drag and Drop with Visual Feedback
    function handleDragOver(e) {
        e.preventDefault();
        const dropZone = document.getElementById('dropZone');
        if (e.dataTransfer.types.includes('Files')) {
            dropZone.classList.add('active');
        }
    }

    function handleDragLeave(e) {
        e.preventDefault();
        if (e.clientX === 0 || e.clientY === 0 ||
            e.clientX === window.innerWidth || e.clientY === window.innerHeight) {
            document.getElementById('dropZone').classList.remove('active');
        }
    }

    function handleFileDrop(e) {
        e.preventDefault();
        document.getElementById('dropZone').classList.remove('active');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            const file = files[0];
            if (file.type === 'application/pdf') {
                clearPreviousPDF();
                loadPDFFromFile(file);
            } else {
                showToast('Lütfen sadece PDF dosyası sürükleyip bırakın!', 'warning');
            }
        }
    }

    function clearPreviousPDF() {
        // Implementation for clearing previous PDF if needed
        showToast('Yeni dosya yükleniyor...', 'info');
    }

    function adjustToolbarPosition() {
        const toolbar = document.getElementById('drawingToolbar');
        const rect = toolbar.getBoundingClientRect();

        if (rect.left < 0 || rect.top < 0 ||
            rect.right > window.innerWidth || rect.bottom > window.innerHeight) {
            toolbar.style.left = '2%';
            toolbar.style.top = window.innerWidth <= 768 ? '42px' : '50px';
            toolbar.style.transform = 'none';
        }
    }

    function setupMobileRotationSupport() {
        const rotateLeftBtn = document.querySelector('[onclick*="rotatePDF(-90)"]');
        const rotateRightBtn = document.querySelector('[onclick*="rotatePDF(90)"]');

        if (rotateLeftBtn) {
            rotateLeftBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                e.stopPropagation();
                rotatePDF(-90);
            }, { passive: false });
        }

        if (rotateRightBtn) {
            rotateRightBtn.addEventListener('touchstart', (e) => {
                e.preventDefault();
                e.stopPropagation();
                rotatePDF(90);
            }, { passive: false });
        }

        document.querySelectorAll('.footer-icon, .icon, .drawing-tool, .color-picker').forEach(element => {
            element.addEventListener('touchstart', (e) => {
                e.stopPropagation();
                element.style.transform = 'scale(0.95)';
            }, { passive: true });

            element.addEventListener('touchend', (e) => {
                element.style.transform = '';
            }, { passive: true });
        });
    }

    function handleContextMenu(e) {
        e.preventDefault();

        const contextMenu = document.getElementById('contextMenu');
        contextMenu.style.display = 'block';

        let x = e.pageX;
        let y = e.pageY;

        const menuRect = contextMenu.getBoundingClientRect();
        if (x + menuRect.width > window.innerWidth) {
            x = window.innerWidth - menuRect.width - 10;
        }
        if (y + menuRect.height > window.innerHeight) {
            y = window.innerHeight - menuRect.height - 10;
        }

        contextMenu.style.left = x + 'px';
        contextMenu.style.top = y + 'px';

        setTimeout(() => {
            document.addEventListener('click', hideContextMenu, { once: true });
        }, 10);
    }

    function hideContextMenu() {
        document.getElementById('contextMenu').style.display = 'none';
    }

    function contextMenuAction(action) {
        hideContextMenu();

        switch(action) {
            case 'copy':
                if (selectedDrawings.size > 0) {
                    copySelectedDrawings();
                } else {
                    showToast('Kopyalanacak çizim seçin', 'warning');
                }
                break;
            case 'selectAll':
                selectAllDrawings();
                break;
            case 'zoomIn':
                zoomIn();
                break;
            case 'zoomOut':
                zoomOut();
                break;
            case 'rotateLeft':
                rotatePDF(-90);
                break;
            case 'rotateRight':
                rotatePDF(90);
                break;
            case 'fullscreen':
                toggleFullscreen();
                break;
            case 'printPage':
                printCurrentPage();
                break;
            case 'saveImage':
                saveCurrentPageAsImage();
                break;
        }
    }

    function printCurrentPage() {
        const currentPageElement = document.querySelector(`[data-page-num="${currentPage}"] img`);
        if (currentPageElement) {
            const printWindow = window.open('', '_blank');
            printWindow.document.write(`
                <html>
                    <head><title>Sayfa ${currentPage} - Yazdır</title></head>
                    <body style="margin:0; display:flex; justify-content:center; align-items:center; min-height:100vh;">
                        <img src="${currentPageElement.src}" style="max-width:100%; max-height:100%; object-fit:contain;" />
                    </body>
                </html>
            `);
            printWindow.document.close();
            printWindow.print();
            showToast(`Sayfa ${currentPage} yazdırılıyor`, 'success');
        } else {
            showToast('Sayfa henüz yüklenmemiş', 'warning');
        }
    }

    function saveCurrentPageAsImage() {
        const currentPageElement = document.querySelector(`[data-page-num="${currentPage}"] img`);
        if (currentPageElement) {
            const link = document.createElement('a');
            link.download = `sayfa_${currentPage}_${Date.now()}.jpg`;
            link.href = currentPageElement.src;
            link.click();
            showToast(`Sayfa ${currentPage} Ultra HD kalitede kaydedildi`, 'success');
        } else {
            showToast('Sayfa henüz yüklenmemiş', 'warning');
        }
    }

    function setupModalAutoClose() {
        const modals = [
            { id: 'themePopup', content: '.theme-popup-content' },
            { id: 'searchModal', content: '.modal-content' },
            { id: 'urlModal', content: '.modal-content' },
            { id: 'recentFilesModal', content: '.recent-files-content' },
            { id: 'infoPopup', content: '.info-content' },
            { id: 'hotkeyPopup', content: '.hotkey-content' }
        ];

        modals.forEach(({ id, content }) => {
            const modal = document.getElementById(id);
            if (modal) {
                modal.addEventListener('click', function(e) {
                    const contentElement = this.querySelector(content);
                    if (contentElement && !contentElement.contains(e.target)) {
                        hideModalById(id);
                    }
                });
            }
        });

        document.addEventListener('click', function(e) {
            if (e.target.closest('.drawing-toolbar') ||
                e.target.closest('.auto-scroll-container') ||
                e.target.closest('.zoom-container') ||
                e.target.closest('.selection-overlay') ||
                e.target.closest('.manipulation-handle') ||
                isDraggingToolbar || isManipulating) {
                return;
            }

            const openModals = document.querySelectorAll('.modal-overlay.show, .theme-popup.show, .recent-files-modal.show, .info-popup.show, .hotkey-popup.show');
            openModals.forEach(modal => {
                if (!modal.querySelector('*').contains(e.target)) {
                    modal.classList.remove('show');
                }
            });
        });
    }

    function hideModalById(modalId) {
        const modal = document.getElementById(modalId);
        if (modal) {
            modal.classList.remove('show');
        }
    }

    function updateLastViewedPage() {
        if (currentFileInfo && currentPage) {
            currentFileInfo.lastPage = currentPage;
        }
    }

    function handleKeyboardShortcuts(e) {
        if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
            return;
        }

        if (e.key === 'Escape') {
            e.preventDefault();
            hideAllModals();
            clearAllSelections();
            finishManipulation();
            return;
        }

        const openPopups = document.querySelectorAll('.modal-overlay.show, .theme-popup.show, .recent-files-modal.show, .info-popup.show, .hotkey-popup.show');
        if (openPopups.length > 0) {
            if ((e.key === 'i' || e.key === 'I') && document.getElementById('infoPopup').classList.contains('show')) {
                e.preventDefault();
                hideInfoPopup();
                return;
            }
            if ((e.key === 'h' || e.key === 'H') && document.getElementById('hotkeyPopup').classList.contains('show')) {
                e.preventDefault();
                hideHotkeyPopup();
                return;
            }
            return;
        }

        if (e.ctrlKey || e.metaKey) {
            switch(e.key) {
                case 'o':
                    e.preventDefault();
                    openFilePicker();
                    break;
                case 'f':
                    e.preventDefault();
                    openSearchModal();
                    break;
                case 'r':
                    e.preventDefault();
                    showRecentFiles();
                    break;
                case 't':
                    e.preventDefault();
                    showThemePopup();
                    break;
                case 'b':
                    e.preventDefault();
                    toggleBookmarks();
                    break;
                case 'd':
                    e.preventDefault();
                    toggleDrawingTools();
                    break;
                case 's':
                    e.preventDefault();
                    if (isDrawingMode) {
                        saveDrawing();
                    }
                    break;
                case 'z':
                    e.preventDefault();
                    if (e.shiftKey) {
                        redoDrawing();
                    } else {
                        undoDrawing();
                    }
                    break;
                case 'y':
                    e.preventDefault();
                    redoDrawing();
                    break;
                case 'a':
                    e.preventDefault();
                    if (isDrawingMode) {
                        selectAllDrawings();
                    }
                    break;
                case 'c':
                    e.preventDefault();
                    if (isDrawingMode && selectedDrawings.size > 0) {
                        copySelectedDrawings();
                    }
                    break;
                case 'v':
                    e.preventDefault();
                    if (isDrawingMode && copiedDrawings.length > 0) {
                        pasteDrawings();
                    }
                    break;
            }
        } else {
            switch(e.key) {
                case 'ArrowLeft':
                    e.preventDefault();
                    previousPage();
                    break;
                case 'ArrowRight':
                    e.preventDefault();
                    nextPage();
                    break;
                case 'Home':
                    e.preventDefault();
                    goToFirstPage();
                    break;
                case 'End':
                    e.preventDefault();
                    goToLastPage();
                    break;
                case 'F11':
                    e.preventDefault();
                    toggleFullscreen();
                    break;
                case '+':
                case '=':
                    if (!e.ctrlKey) {
                        e.preventDefault();
                        zoomIn();
                    }
                    break;
                case '-':
                    if (!e.ctrlKey) {
                        e.preventDefault();
                        zoomOut();
                    }
                    break;
                case ' ':
                    e.preventDefault();
                    if (e.shiftKey) {
                        previousPage();
                    } else {
                        nextPage();
                    }
                    break;
                case 'r':
                case 'R':
                    e.preventDefault();
                    rotatePDF(90);
                    break;
                case 'l':
                case 'L':
                    e.preventDefault();
                    if (isDrawingMode) {
                        selectTool('lasso');
                    } else {
                        rotatePDF(-90);
                    }
                    break;
                case 'b':
                case 'B':
                    e.preventDefault();
                    toggleBookmarks();
                    break;
                case 'f':
                case 'F':
                    e.preventDefault();
                    toggleFullscreen();
                    break;
                case 'i':
                case 'I':
                    e.preventDefault();
                    showInfoPopup();
                    break;
                case 'h':
                case 'H':
                    e.preventDefault();
                    if (isDrawingMode) {
                        selectTool('highlight');
                    } else {
                        showHotkeyPopup();
                    }
                    break;
                case 'd':
                case 'D':
                    e.preventDefault();
                    toggleDrawingTools();
                    break;
                case 'p':
                case 'P':
                    e.preventDefault();
                    if (isDrawingMode) selectTool('pen');
                    break;
                case 'e':
                case 'E':
                    e.preventDefault();
                    if (isDrawingMode) selectTool('eraser');
                    break;
                case 's':
                case 'S':
                    e.preventDefault();
                    if (isDrawingMode) selectTool('rectSelect');
                    break;
                case 'g':
                case 'G':
                    e.preventDefault();
                    if (isDrawingMode) selectTool('hand');
                    break;
                case 't':
                case 'T':
                    e.preventDefault();
                    if (isDrawingMode) selectTool('text');
                    break;
                case 'c':
                case 'C':
                    e.preventDefault();
                    if (isDrawingMode) selectTool('screenshot');
                    break;
                case 'm':
                case 'M':
                    e.preventDefault();
                    if (isDrawingMode) selectTool('measure');
                    break;
                case 'n':
                case 'N':
                    e.preventDefault();
                    if (isDrawingMode) selectTool('numberline');
                    break;
                case 'o':
                case 'O':
                    e.preventDefault();
                    showRecentFiles();
                    break;
                case 'Delete':
                    e.preventDefault();
                    if (isDrawingMode && selectedDrawings.size > 0) {
                        deleteSelectedDrawings();
                    }
                    break;
            }
        }
    }

    function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
            const later = () => {
                clearTimeout(timeout);
                func(...args);
            };
            clearTimeout(timeout);
            timeout = setTimeout(later, wait);
        };
    }

    // File Operations
    function openFilePicker() {
        document.getElementById('fileInput').click();
    }

    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (file && file.type === 'application/pdf') {
            clearPreviousPDF();
            loadPDFFromFile(file);
        } else {
            showToast('Lütfen geçerli bir PDF dosyası seçin!', 'warning');
        }
    }

    async function loadPDFFromFile(file) {
        showLoading('PDF yükleniyor...', 0);
        showToast('PDF yükleme özelliği geliştirme aşamasındadır', 'info');
        hideLoading();
    }

    function loadFromUrl() {
        showToast('URL yükleme özelliği geliştirme aşamasındadır', 'info');
    }

    // Navigation Functions
    function goToPage(pageNum) {
        if (pageNum < 1 || pageNum > totalPages) return;

        currentPage = pageNum;
        updatePageInfo();
        updateLastViewedPage();

        const pageElement = document.querySelector(`[data-page-num="${pageNum}"]`);
        if (pageElement) {
            pageElement.scrollIntoView({
                behavior: 'smooth',
                block: 'center',
                inline: 'center'
            });

            loadImagePageNow(pageNum);

            setTimeout(() => {
                if (pageNum > 1) loadImagePageNow(pageNum - 1);
                if (pageNum < totalPages) loadImagePageNow(pageNum + 1);
            }, 500);
        }
    }

    function goToFirstPage() {
        goToPage(1);
    }

    function goToLastPage() {
        goToPage(totalPages);
    }

    function nextPage() {
        if (currentPage < totalPages) {
            goToPage(currentPage + 1);
        } else {
            showToast('Son sayfadasınız', 'info');
        }
    }

    function previousPage() {
        if (currentPage > 1) {
            goToPage(currentPage - 1);
        } else {
            showToast('İlk sayfadasınız', 'info');
        }
    }

    function handlePageInputChange() {
        const pageInput = document.getElementById('pageInput');
        const pageNum = parseInt(pageInput.value);
        if (pageNum && pageNum >= 1 && pageNum <= totalPages) {
            goToPage(pageNum);
        } else {
            pageInput.value = currentPage;
            showToast('Geçersiz sayfa numarası!', 'warning');
        }
    }

    function updatePageInfo() {
        document.getElementById('pageInput').value = currentPage;
        document.getElementById('pageInfo').textContent = `/ ${totalPages}`;
    }

    // Zoom Functions
    function toggleZoomControls() {
        const container = document.getElementById('zoomContainer');
        const autoScrollContainer = document.getElementById('autoScrollContainer');

        if (autoScrollContainer.classList.contains('show')) {
            autoScrollContainer.classList.remove('show');
            stopAutoScroll();
            document.getElementById('autoScrollIcon').innerHTML = '<i class="fas fa-play"></i>';
            document.getElementById('autoScrollIcon').classList.remove('active');
        }

        container.classList.toggle('show');

        if (container.classList.contains('show')) {
            updateZoomSlider();
            showToast('Zoom kontrolleri açıldı', 'info');
        } else {
            showToast('Zoom kontrolleri kapatıldı', 'info');
        }
    }

    function updateZoomSlider() {
        const slider = document.getElementById('zoomSlider');
        const value = document.getElementById('zoomValue');
        const percentage = Math.round(scale * 100);

        slider.value = percentage;
        value.textContent = percentage + '%';
    }

    function setZoom(value) {
        scale = parseFloat(value) / 100;
        rerenderVisiblePages();
        updateZoomSlider();
    }

    function zoomIn() {
        scale = Math.min(scale * 1.25, 5.0);
        rerenderVisiblePages();
        updateZoomSlider();
        showToast(`Zoom: ${Math.round(scale * 100)}%`, 'info');
    }

    function zoomOut() {
        scale = Math.max(scale / 1.25, 0.25);
        rerenderVisiblePages();
        updateZoomSlider();
        showToast(`Zoom: ${Math.round(scale * 100)}%`, 'info');
    }

    async function rerenderVisiblePages() {
        // Save persistent drawings before clearing
        drawingCanvases.forEach((canvas, pageNum) => {
            if (canvas) {
                persistentDrawings.set(pageNum, canvas.toDataURL());
            }
        });

        pageCache.clear();

        const visiblePages = document.querySelectorAll('.pdf-page img');
        const rerenderPromises = [];

        visiblePages.forEach(img => {
            const pageDiv = img.closest('.pdf-page');
            const pageNum = parseInt(pageDiv.getAttribute('data-page-num'));
            rerenderPromises.push(loadImagePageNow(pageNum));
        });

        drawingCanvases.clear();
        drawingContexts.clear();

        await Promise.all(rerenderPromises);
        adjustPDFPagesToViewport();
    }

    // Auto Scroll Functions
    function toggleAutoScroll() {
        isAutoScrolling = !isAutoScrolling;
        const icon = document.getElementById('autoScrollIcon');
        const container = document.getElementById('autoScrollContainer');
        const zoomContainer = document.getElementById('zoomContainer');

        if (zoomContainer.classList.contains('show')) {
            zoomContainer.classList.remove('show');
        }

        if (isAutoScrolling) {
            icon.innerHTML = '<i class="fas fa-pause"></i>';
            icon.classList.add('active');
            icon.title = 'Otomatik Kaydırmayı Durdur';
            container.classList.add('show');

            startAutoScroll();
            showToast('Otomatik kaydırma başlatıldı', 'success');
        } else {
            icon.innerHTML = '<i class="fas fa-play"></i>';
            icon.classList.remove('active');
            icon.title = 'Otomatik Kaydırma';
            container.classList.remove('show');
            stopAutoScroll();
            showToast('Otomatik kaydırma durduruldu', 'info');
        }
    }

    function startAutoScroll() {
        if (autoScrollInterval) {
            clearInterval(autoScrollInterval);
        }
        if (smoothScrollFrame) {
            cancelAnimationFrame(smoothScrollFrame);
        }

        const mainContent = document.getElementById('mainContent');
        let lastTime = performance.now();

        function smoothScroll(currentTime) {
            if (!isAutoScrolling) return;

            const deltaTime = currentTime - lastTime;
            lastTime = currentTime;

            const scrollAmount = (scrollSpeed * deltaTime * 0.05);

            if (mainContent.scrollTop + mainContent.clientHeight >= mainContent.scrollHeight - 10) {
                toggleAutoScroll();
                showToast('Belge sonuna ulaşıldı', 'info');
                return;
            }

            mainContent.scrollBy({
                top: scrollAmount,
                behavior: 'auto'
            });

            smoothScrollFrame = requestAnimationFrame(smoothScroll);
        }

        smoothScrollFrame = requestAnimationFrame(smoothScroll);
    }

    function stopAutoScroll() {
        if (autoScrollInterval) {
            clearInterval(autoScrollInterval);
            autoScrollInterval = null;
        }
        if (smoothScrollFrame) {
            cancelAnimationFrame(smoothScrollFrame);
            smoothScrollFrame = null;
        }
    }

    function increaseScrollSpeed() {
        scrollSpeed = Math.min(scrollSpeed + 1, 10);
        updateScrollSpeedDisplay();
    }

    function decreaseScrollSpeed() {
        scrollSpeed = Math.max(scrollSpeed - 1, 1);
        updateScrollSpeedDisplay();
    }

    function setScrollSpeed(value) {
        scrollSpeed = parseInt(value);
        updateScrollSpeedDisplay();
    }

    function updateScrollSpeedDisplay() {
        document.getElementById('scrollSpeedValue').textContent = scrollSpeed + 'x';
        document.getElementById('scrollSpeedSlider').value = scrollSpeed;
    }

    function toggleDrawingTools() {
        isDrawingMode = !isDrawingMode;
        const toolbar = document.getElementById('drawingToolbar');
        const mainContent = document.getElementById('mainContent');

        if (isDrawingMode) {
            toolbar.classList.add('show');
            mainContent.classList.add('drawing-active');
            createDrawingCanvasesForAllPages();
            updateCursor();
            showToast('Çizim modu aktif - Ultra gelişmiş seçim ve manipülasyon araçları hazır', 'success');
        } else {
            toolbar.classList.remove('show');
            mainContent.classList.remove('drawing-active');
            clearAllSelections();
            finishManipulation();
            updateCursor();
            showToast('Çizim modu kapalı', 'info');
        }
    }

    function createDrawingCanvasesForAllPages() {
        document.querySelectorAll('.pdf-page').forEach(pageDiv => {
            const pageNum = parseInt(pageDiv.getAttribute('data-page-num'));
            const img = pageDiv.querySelector('img');
            if (img && !pageDiv.querySelector('.drawing-canvas')) {
                createDrawingCanvas(pageDiv, pageNum);
            }
        });
    }

    function createDrawingCanvas(pageDiv, pageNum) {
        const existingCanvas = pageDiv.querySelector('.drawing-canvas');
        if (existingCanvas) return;

        const img = pageDiv.querySelector('img');
        if (!img) return;

        const drawingCanvas = document.createElement('canvas');
        drawingCanvas.className = 'drawing-canvas';
        drawingCanvas.width = img.naturalWidth || img.width;
        drawingCanvas.height = img.naturalHeight || img.height;
        drawingCanvas.style.position = 'absolute';
        drawingCanvas.style.top = '0';
        drawingCanvas.style.left = '0';
        drawingCanvas.style.width = '100%';
        drawingCanvas.style.height = '100%';
        drawingCanvas.style.pointerEvents = 'none';
        drawingCanvas.style.zIndex = '10';

        const ctx = drawingCanvas.getContext('2d');
        ctx.lineCap = 'round';
        ctx.lineJoin = 'round';

        pageDiv.appendChild(drawingCanvas);

        drawingCanvases.set(pageNum, drawingCanvas);
        drawingContexts.set(pageNum, ctx);

        if (persistentDrawings.has(pageNum)) {
            const imgData = new Image();
            imgData.onload = () => {
                ctx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
                ctx.drawImage(imgData, 0, 0);
            };
            imgData.src = persistentDrawings.get(pageNum);
        }

        setupDrawingEvents(drawingCanvas, pageDiv, pageNum);
    }

    function setupDrawingEvents(canvas, pageDiv, pageNum) {
        // Placeholder for drawing events - implement as needed
        showToast('Çizim araçları hazır', 'info');
    }

    function selectTool(tool) {
        currentTool = tool;

        document.querySelectorAll('.drawing-tool').forEach(btn => btn.classList.remove('active'));
        const toolButton = document.getElementById(tool + 'Tool');
        if (toolButton) {
            toolButton.classList.add('active');

            toolButton.style.animation = 'pulse 0.3s ease';
            setTimeout(() => {
                toolButton.style.animation = '';
            }, 300);
        }

        clearAllSelections();
        finishManipulation();
        updateCursor();

        showToast(`${getToolName(tool)} aracı seçildi`, 'info');
    }

    function updateCursor() {
        document.body.className = document.body.className.replace(/\bcursor-\w+\b/g, '').trim();

        if (isDrawingMode) {
            const cursorClass = `cursor-${currentTool}`;
            if (currentTool !== 'hand') {
                 document.body.classList.add(cursorClass);
            }
        }
    }

    function selectColor(color) {
        currentColor = color;

        document.querySelectorAll('.color-picker').forEach(picker => picker.classList.remove('active'));
        event.target.classList.add('active');

        showToast(`Renk: ${color}`, 'info');
    }

    function getToolName(tool) {
        const names = {
            'pen': 'Kalem',
            'eraser': 'Silgi',
            'highlight': 'Fosforlu Kalem',
            'hand': 'El',
            'rectSelect': 'Dikdörtgen Seçim',
            'lasso': 'Lasso Seçim',
            'screenshot': 'Ekran Alıntısı',
            'text': 'Metin',
            'measure': 'Ölçüm',
            'numberline': 'Sayı Doğrusu'
        };
        return names[tool] || tool;
    }

    // Theme Management
    function showThemePopup(event) {
        if (event) event.stopPropagation();
        document.getElementById('themePopup').classList.add('show');
        updateThemeSelection();
    }

    function hideThemePopup() {
        document.getElementById('themePopup').classList.remove('show');
    }

    function selectTheme(themeName) {
        currentTheme = themeName;
        document.body.className = `theme-${themeName}`;
        updateThemeSelection();

        localStorage.setItem('pdfViewerTheme', themeName);
        showToast(`Tema değiştirildi: ${getThemeName(themeName)}`, 'success');
    }

    function updateThemeSelection() {
        document.querySelectorAll('.theme-option').forEach(option => {
            option.classList.remove('active');
        });
        const activeOption = document.querySelector(`[data-theme="${currentTheme}"]`);
        if (activeOption) {
            activeOption.classList.add('active');
        }
    }

    function applyCustomTheme() {
        const headerColor = document.getElementById('headerColor').value;
        const accentColor = document.getElementById('accentColor').value;

        document.documentElement.style.setProperty('--header-bg-start', headerColor);
        document.documentElement.style.setProperty('--header-bg-end', headerColor);
        document.documentElement.style.setProperty('--footer-bg-start', headerColor);
        document.documentElement.style.setProperty('--footer-bg-end', headerColor);
        document.documentElement.style.setProperty('--accent-color', accentColor);

        showToast('Özel tema uygulandı!', 'success');
    }

    function getThemeName(theme) {
        const names = {
            'default': 'Varsayılan',
            'forest': 'Orman',
            'sunset': 'Gün Batımı',
            'ocean': 'Okyanus',
            'purple': 'Mor',
            'dark': 'Karanlık',
            'golden': 'Altın',
            'emerald': 'Zümrüt',
            'crimson': 'Kızıl',
            'royal': 'Kraliyet'
        };
        return names[theme] || theme;
    }

    // Info and Hotkey Popups
    function showInfoPopup(event) {
        if (event) event.stopPropagation();
        document.getElementById('infoPopup').classList.add('show');
    }

    function hideInfoPopup() {
        document.getElementById('infoPopup').classList.remove('show');
    }

    function showHotkeyPopup(event) {
        if (event) event.stopPropagation();
        document.getElementById('hotkeyPopup').classList.add('show');
    }

    function hideHotkeyPopup() {
        document.getElementById('hotkeyPopup').classList.remove('show');
    }

    // Search Functions
    function openSearchModal(event) {
        if (event) event.stopPropagation();
        document.getElementById('searchModal').classList.add('show');
        document.getElementById('searchInput').focus();
    }

    function closeSearchModal() {
        document.getElementById('searchModal').classList.remove('show');
        document.getElementById('searchInput').value = '';
        hideSearchResults();
    }

    function handleSearchKeyPress(event) {
        if (event.key === 'Enter') {
            performSearch();
        }
    }

    async function performSearch() {
        showToast('Arama özelliği geliştirme aşamasındadır', 'info');
    }

    function findNext() {
        showToast('Arama özelliği geliştirme aşamasındadır', 'info');
    }

    function findPrevious() {
        showToast('Arama özelliği geliştirme aşamasındadır', 'info');
    }

    function clearSearch() {
        document.getElementById('searchInput').value = '';
        hideSearchResults();
        showToast('Arama temizlendi', 'info');
    }

    function hideSearchResults() {
        document.getElementById('searchResults').style.display = 'none';
    }

    // URL Modal Functions
    function showUrlPopup() {
        document.getElementById('popupOverlay').classList.remove('hidden');
        document.getElementById('urlInput').focus();
    }

    function closePopup() {
        document.getElementById('popupOverlay').classList.add('hidden');
        document.getElementById('urlInput').value = '';
    }

    // Recent Files Management
    function loadRecentFiles() {
        try {
            const stored = localStorage.getItem('recentPDFFiles');
            if (stored) {
                recentFiles = JSON.parse(stored);
            }

            const savedTheme = localStorage.getItem('pdfViewerTheme');
            if (savedTheme) {
                selectTheme(savedTheme);
            }

            const storedNotes = localStorage.getItem('pdfViewerNotes');
            if (storedNotes) {
                notes = JSON.parse(storedNotes);
            }
        } catch (error) {
            console.error('Error loading recent files:', error);
        }
    }

    function saveRecentFiles() {
        try {
            localStorage.setItem('recentPDFFiles', JSON.stringify(recentFiles));
        } catch (error) {
            console.error('Error saving recent files:', error);
        }
    }

    function addToRecentFiles(fileName, pages, url = null, lastPage = 1) {
        const newFile = {
            name: fileName,
            pages: pages,
            date: new Date().toLocaleString('tr-TR'),
            timestamp: Date.now(),
            url: url,
            lastPage: lastPage || 1,
            path: url || fileName
        };

        recentFiles = recentFiles.filter(file =>
            file.name !== fileName && file.path !== (url || fileName)
        );

        recentFiles.unshift(newFile);
        recentFiles = recentFiles.slice(0, 10);

        saveRecentFiles();
    }

    function showRecentFiles(event) {
        if (event) event.stopPropagation();
        const modal = document.getElementById('recentFilesModal');
        const list = document.getElementById('recentFilesList');

        if (recentFiles.length === 0) {
            list.innerHTML = `
                <div style="color: rgba(255,255,255,0.5); text-align: center; padding: 40px; font-size: 16px;">
                    <i class="fas fa-history" style="font-size: 64px; margin-bottom: 20px; display: block; opacity: 0.3;"></i>
                    Henüz açılan dosya yok
                </div>
            `;
        } else {
            list.innerHTML = recentFiles.map(file => `
                <div class="recent-file-item" onclick="loadRecentFile('${encodeURIComponent(JSON.stringify(file))}')">
                    <div class="recent-file-name">
                        <i class="fas fa-file-pdf" style="margin-right: 10px; color: #e74c3c; font-size: 16px;"></i>
                        ${file.name}
                    </div>
                    <div class="recent-file-details">
                        <span class="recent-file-pages">
                            <i class="fas fa-file-alt" style="margin-right: 6px;"></i>
                            ${file.pages} sayfa
                        </span>
                        <span class="recent-file-date">
                            <i class="fas fa-clock" style="margin-right: 6px;"></i>
                            ${file.date}
                        </span>
                    </div>
                    <div class="recent-file-lastpage">
                        <i class="fas fa-bookmark" style="margin-right: 6px; color: var(--accent-color);"></i>
                        Son bakılan: Sayfa ${file.lastPage || 1}
                    </div>
                </div>
            `).join('');
        }

        modal.classList.add('show');
    }

    async function loadRecentFile(encodedFileData) {
        try {
            const file = JSON.parse(decodeURIComponent(encodedFileData));
            hideRecentFiles();

            if (file.url) {
                showToast(`"${file.name}" yükleniyor...`, 'info');
                
                if (file.lastPage && file.lastPage > 1) {
                    setTimeout(() => {
                        goToPage(file.lastPage);
                        showToast(`Son bakılan sayfa: ${file.lastPage}`, 'info');
                    }, 1500);
                }
            } else {
                showToast('Bu dosya artık mevcut değil (yerel dosya)', 'warning');
            }
        } catch (error) {
            showToast('Dosya yüklenirken hata oluştu', 'error');
            console.error('Error loading recent file:', error);
        }
    }

    function hideRecentFiles() {
        document.getElementById('recentFilesModal').classList.remove('show');
    }

    function clearRecentFiles() {
        if (confirm('Tüm son açılan dosyaları temizlemek istediğinizden emin misiniz?')) {
            recentFiles = [];
            saveRecentFiles();
            hideRecentFiles();
            showToast('Son açılan dosyalar temizlendi', 'success');
        }
    }

    // Rotation Functions
    async function rotatePDF(angle) {
        rotation = (rotation + angle) % 360;
        showLoading('Sayfalar döndürülüyor...', 0);

        try {
            await rerenderVisiblePages();
            hideLoading();
            showToast(`Sayfalar ${angle > 0 ? 'sağa' : 'sola'} döndürüldü (${rotation}°)`, 'success');

            updateRecentFileLastPage();
        } catch (error) {
            hideLoading();
            showToast('Sayfalar döndürülürken hata oluştu', 'error');
        }
    }

    // Utility Functions
    function showPDFContainer() {
        document.getElementById('welcomeScreen').style.display = 'none';
        document.getElementById('pdfContainer').classList.add('show');
    }

    function goHome(permanent = false) {
        const pdfContainer = document.getElementById('pdfContainer');
        const welcomeScreen = document.getElementById('welcomeScreen');

        if (pdfContainer.classList.contains('show')) {
            pdfContainer.classList.remove('show');
            welcomeScreen.style.display = 'flex';

            document.querySelectorAll('.drawing-tool.active').forEach(btn => btn.classList.remove('active'));
            document.getElementById('drawingToolbar')?.classList.remove('show');

            hideAllModals();
            showToast('Ana sayfaya dönüldü', 'info');
        }
    }

    function toggleBookmarks(event) {
        if (event) event.stopPropagation();
        const panel = document.getElementById('bookmarksPanel');
        panel.classList.toggle('show');

        if (panel.classList.contains('show') && bookmarks.length === 0) {
            showToast('Yer imleri yüklendi', 'info');
        }
    }

    function toggleFullscreen() {
        if (!document.fullscreenElement) {
            document.documentElement.requestFullscreen().then(() => {
                showToast('Tam ekran modu açık - ESC ile çıkabilirsiniz', 'success');
            }).catch(() => {
                showToast('Tam ekran moduna geçilemedi', 'error');
            });
        } else {
            document.exitFullscreen().then(() => {
                showToast('Tam ekran modu kapalı', 'info');
            });
        }
    }

    function toggleInfo() {
        showInfoPopup();
    }

    function hideAllModals() {
        document.querySelectorAll('.theme-popup, .recent-files-modal, .notes-modal, .modal-overlay, .info-popup, .hotkey-popup').forEach(modal => {
            modal.classList.remove('show');
        });
        document.getElementById('bookmarksPanel').classList.remove('show');
        document.getElementById('autoScrollContainer').classList.remove('show');
        document.getElementById('zoomContainer').classList.remove('show');
        document.getElementById('thumbnailPanel').classList.remove('show');
        hideContextMenu();
        clearAllSelections();
        finishManipulation();
    }

    // Loading and Progress
    function showLoading(text, progress) {
        const overlay = document.getElementById('loadingOverlay');
        const textElement = document.getElementById('loadingText');
        const progressElement = document.getElementById('progressFill');

        textElement.textContent = text;
        progressElement.style.width = Math.min(progress, 100) + '%';
        overlay.classList.add('show');
    }

    function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('show');
    }

    function updateProgress(progress) {
        document.getElementById('progressFill').style.width = Math.min(progress, 100) + '%';
    }

    // Notes Management Functions
    function showNotesModal(event) {
        if (event) event.stopPropagation();
        const modal = document.getElementById('notesModal');
        displayNotes();
        modal.classList.add('show');
    }

    function hideNotesModal() {
        document.getElementById('notesModal').classList.remove('show');
        document.getElementById('noteInput').value = '';
    }

    let isNotePriorityActive = false;

    function toggleNotePriority() {
        isNotePriorityActive = !isNotePriorityActive;
        const btn = document.getElementById('notePriority');
        if (isNotePriorityActive) {
            btn.classList.add('active');
            btn.style.background = 'var(--note-favorite)';
            btn.style.color = 'black';
        } else {
            btn.classList.remove('active');
            btn.style.background = 'rgba(255, 255, 255, 0.1)';
            btn.style.color = 'white';
        }
    }

    function addNote() {
        const noteInput = document.getElementById('noteInput');
        const noteCategory = document.getElementById('noteCategory');
        const noteText = noteInput.value.trim();

        if (!noteText) {
            showToast('Lütfen bir not yazın!', 'warning');
            return;
        }

        const newNote = {
            id: Date.now(),
            content: noteText,
            category: noteCategory.value,
            isFavorite: isNotePriorityActive,
            pdfName: currentFileInfo ? currentFileInfo.name : 'Genel Not',
            pageNumber: currentPage || 1,
            date: new Date().toLocaleString('tr-TR'),
            timestamp: Date.now()
        };

        notes.unshift(newNote);
        saveNotes();
        noteInput.value = '';
        noteCategory.value = 'genel';
        isNotePriorityActive = false;
        toggleNotePriority();
        displayNotes();

        const categoryText = noteCategory.options[noteCategory.selectedIndex].text;
        showToast(`${newNote.isFavorite ? '⭐ ' : ''}Not eklendi: ${categoryText}`, 'success');
    }

    function deleteNote(noteId) {
        if (confirm('Bu notu silmek istediğinizden emin misiniz?')) {
            notes = notes.filter(note => note.id !== noteId);
            saveNotes();
            displayNotes();
            showToast('Not silindi', 'info');
        }
    }

    function displayNotes() {
        const notesList = document.getElementById('notesList');

        if (notes.length === 0) {
            notesList.innerHTML = `
                <div class="no-notes">
                    <i class="fas fa-sticky-note"></i>
                    Henüz not yok
                </div>
            `;
            return;
        }

        const sortedNotes = [...notes].sort((a, b) => {
            if (a.isFavorite && !b.isFavorite) return -1;
            if (!a.isFavorite && b.isFavorite) return 1;
            return b.timestamp - a.timestamp;
        });

        notesList.innerHTML = sortedNotes.map(note => `
            <div class="note-item">
                ${note.isFavorite ? '<div class="note-favorite-badge"><i class="fas fa-star"></i></div>' : ''}
                <div class="note-content">${note.content}</div>
                <div class="note-meta">
                    <div class="note-info">
                        <span class="note-pdf">
                            <i class="fas fa-file-pdf"></i>
                            ${note.pdfName}
                        </span>
                        <span class="note-page">
                            <i class="fas fa-bookmark"></i>
                            Sayfa ${note.pageNumber}
                        </span>
                        <span class="note-date">
                            <i class="fas fa-clock"></i>
                            ${note.date}
                        </span>
                    </div>
                    <button class="note-delete" onclick="deleteNote(${note.id})" title="Notu Sil">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </div>
        `).join('');
    }

    function saveNotes() {
        try {
            localStorage.setItem('pdfViewerNotes', JSON.stringify(notes));
        } catch (error) {
            console.error('Error saving notes:', error);
            showToast('Notlar kaydedilirken hata oluştu', 'error');
        }
    }

    function setupToolbarDragging() {
        // Toolbar dragging implementation placeholder
    }

    function setBrushSize(size) {
        brushSize = parseInt(size);
        document.getElementById('brushSizeDisplay').textContent = size + 'px';
        showToast(`Fırça boyutu: ${size}px`, 'info');
    }

    function setOpacity(opacity) {
        currentOpacity = parseInt(opacity);
        document.getElementById('opacityDisplay').textContent = opacity + '%';
        showToast(`Şeffaflık: ${opacity}%`, 'info');
    }

    function toggleGrid() {
        isGridEnabled = !isGridEnabled;
        const gridTool = document.getElementById('gridTool');

        if (isGridEnabled) {
            gridTool.classList.add('active');
            showToast('Izgara açık', 'success');
        } else {
            gridTool.classList.remove('active');
            showToast('Izgara kapalı', 'info');
        }
    }

    function toggleSnap() {
        isSnapEnabled = !isSnapEnabled;
        const snapTool = document.getElementById('snapTool');

        if (isSnapEnabled) {
            snapTool.classList.add('active');
            showToast('Yakalama açık', 'success');
        } else {
            snapTool.classList.remove('active');
            showToast('Yakalama kapalı', 'info');
        }
    }

    function snapToGrid(point) {
        if (!isSnapEnabled) return point;

        const gridSize = 20;
        return {
            x: Math.round(point.x / gridSize) * gridSize,
            y: Math.round(point.y / gridSize) * gridSize
        };
    }

    // ENHANCED THUMBNAIL PANEL WITH FULL LAZY LOADING FOR ALL 605 PAGES
    function toggleThumbnailPanel(event) {
        if (event) event.stopPropagation();
        const panel = document.getElementById('thumbnailPanel');
        const isShowing = panel.classList.contains('show');

        if (isShowing) {
            closeThumbnailPanel();
        } else {
            panel.classList.add('show');
            generateAllThumbnailsLazy();
            showToast('Tüm 605 sayfa önizlemesi lazy loading ile yükleniyor...', 'info');
        }
    }

    function closeThumbnailPanel() {
        const panel = document.getElementById('thumbnailPanel');
        panel.classList.remove('show');
        
        // Clean up thumbnail observer
        if (thumbnailObserver) {
            thumbnailObserver.disconnect();
            thumbnailObserver = null;
        }
        
        // Clear loaded thumbnails set
        thumbnailsLoaded.clear();
        
        showToast('Sayfa önizlemeleri kapatıldı', 'info');
    }

    // ENHANCED FUNCTION TO GENERATE ALL 605 THUMBNAILS WITH LAZY LOADING
    async function generateAllThumbnailsLazy() {
        const thumbnailGrid = document.getElementById('thumbnailGrid');
        thumbnailGrid.innerHTML = '';

        try {
            // Create all thumbnail placeholders first
            for (let pageNum = 1; pageNum <= totalPages; pageNum++) {
                const thumbnailItem = document.createElement('div');
                thumbnailItem.className = 'thumbnail-item loading';
                thumbnailItem.setAttribute('data-page', pageNum);

                if (pageNum === currentPage) {
                    thumbnailItem.classList.add('current');
                }

                // Create placeholder
                const placeholder = document.createElement('div');
                placeholder.className = 'thumbnail-placeholder';
                placeholder.innerHTML = `
                    <div style="font-size: 10px; text-align: center;">
                        <i class="fas fa-image" style="display: block; margin-bottom: 5px; font-size: 16px;"></i>
                        Sayfa ${pageNum}
                    </div>
                `;

                const label = document.createElement('div');
                label.className = 'thumbnail-label';
                label.textContent = `Sayfa ${pageNum}`;

                thumbnailItem.appendChild(placeholder);
                thumbnailItem.appendChild(label);

                thumbnailItem.onclick = () => goToThumbnailPage(pageNum);
                thumbnailGrid.appendChild(thumbnailItem);

                // Add animation delay
                thumbnailItem.style.animationDelay = `${(pageNum % 50) * 0.02}s`;
            }

            // Setup intersection observer for lazy loading
            setupThumbnailObserver();

        } catch (error) {
            console.error('Error setting up thumbnails:', error);
            showToast('Önizlemeler hazırlanırken hata oluştu', 'error');
        }
    }

    // SETUP INTERSECTION OBSERVER FOR THUMBNAIL LAZY LOADING
    function setupThumbnailObserver() {
        if (thumbnailObserver) {
            thumbnailObserver.disconnect();
        }

        thumbnailObserver = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const thumbnailItem = entry.target;
                    const pageNum = parseInt(thumbnailItem.getAttribute('data-page'));
                    
                    if (!thumbnailsLoaded.has(pageNum)) {
                        loadThumbnailImage(pageNum, thumbnailItem);
                        thumbnailsLoaded.add(pageNum);
                    }
                }
            });
        }, {
            threshold: 0.1,
            rootMargin: '200px'
        });

        // Observe all thumbnail items
        document.querySelectorAll('.thumbnail-item').forEach(item => {
            thumbnailObserver.observe(item);
        });
    }

    // LOAD INDIVIDUAL THUMBNAIL IMAGE
    async function loadThumbnailImage(pageNum, thumbnailItem) {
        try {
            const placeholder = thumbnailItem.querySelector('.thumbnail-placeholder');
            
            // Show loading state
            if (placeholder) {
                placeholder.innerHTML = `
                    <div style="font-size: 10px; text-align: center;">
                        <i class="fas fa-spinner fa-spin" style="display: block; margin-bottom: 5px; font-size: 16px; color: var(--accent-color);"></i>
                        Yükleniyor...
                    </div>
                `;
            }

            const imageUrl = BASE_IMAGE_URL + pageNum + '.jpg';
            
            // Create thumbnail image
            const img = document.createElement('img');
            img.className = 'thumbnail-canvas';
            img.src = imageUrl;
            img.alt = `Sayfa ${pageNum}`;
            img.style.opacity = '0';
            img.style.transition = 'opacity 0.3s ease';

            // Wait for image to load
            await new Promise((resolve, reject) => {
                img.onload = () => {
                    // Replace placeholder with actual image
                    if (placeholder && thumbnailItem.contains(placeholder)) {
                        thumbnailItem.replaceChild(img, placeholder);
                        
                        // Fade in effect
                        setTimeout(() => {
                            img.style.opacity = '1';
                        }, 50);
                        
                        // Remove loading class
                        thumbnailItem.classList.remove('loading');
                    }
                    resolve();
                };
                
                img.onerror = () => {
                    reject(new Error(`Failed to load thumbnail: ${imageUrl}`));
                };
            });

        } catch (error) {
            console.error(`Failed to load thumbnail ${pageNum}:`, error);
            
            // Show error state
            const placeholder = thumbnailItem.querySelector('.thumbnail-placeholder');
            if (placeholder) {
                placeholder.innerHTML = `
                    <div style="font-size: 10px; text-align: center; color: #e74c3c;">
                        <i class="fas fa-exclamation-triangle" style="display: block; margin-bottom: 5px; font-size: 16px;"></i>
                        Hata
                    </div>
                `;
            }
            
            thumbnailItem.classList.remove('loading');
        }
    }

    function goToThumbnailPage(pageNum) {
        if (pageNum >= 1 && pageNum <= totalPages) {
            // Update current thumbnail indicator
            const oldCurrent = document.querySelector('.thumbnail-item.current');
            if (oldCurrent) {
                oldCurrent.classList.remove('current');
            }

            const newCurrent = document.querySelector(`.thumbnail-item[data-page="${pageNum}"]`);
            if (newCurrent) {
                newCurrent.classList.add('current');
            }

            goToPage(pageNum);
            document.getElementById('thumbnailPanel').classList.remove('show');
            showToast(`Sayfa ${pageNum}'a gidildi`, 'success');
        }
    }

    // Placeholder functions for drawing functionality
    function selectAllDrawings() {
        showToast('Çizim seçme özelliği geliştirme aşamasındadır', 'info');
    }

    function deleteSelectedDrawings() {
        showToast('Çizim silme özelliği geliştirme aşamasındadır', 'info');
    }

    function copySelectedDrawings() {
        showToast('Çizim kopyalama özelliği geliştirme aşamasındadır', 'info');
    }

    function pasteDrawings() {
        showToast('Çizim yapıştırma özelliği geliştirme aşamasındadır', 'info');
    }

    function undoDrawing() {
        showToast('Geri alma özelliği geliştirme aşamasındadır', 'info');
    }

    function redoDrawing() {
        showToast('İleri alma özelliği geliştirme aşamasındadır', 'info');
    }

    function clearAllDrawing() {
        showToast('Çizim temizleme özelliği geliştirme aşamasındadır', 'info');
    }

    function saveDrawing() {
        showToast('Çizim kaydetme özelliği geliştirme aşamasındadır', 'info');
    }

    function clearAllSelections() {
        // Placeholder
    }

    function finishManipulation() {
        // Placeholder
    }

    function addHighlightOverlay() {
        // Placeholder
    }

    // Page change tracking for recent files
    window.addEventListener('beforeunload', () => {
        updateRecentFileLastPage();
    });

    window.addEventListener('load', () => {
        const savedTheme = localStorage.getItem('pdfViewerTheme');
        if (savedTheme) {
            selectTheme(savedTheme);
        }
    });

    setInterval(() => {
        updateRecentFileLastPage();
    }, 5000);

    // Enhanced error handling
    window.addEventListener('error', (e) => {
        console.error('Global error:', e.error);
        showToast('Bir hata oluştu, lütfen sayfayı yenileyin', 'error');
    });

    window.addEventListener('unhandledrejection', (e) => {
        console.error('Unhandled promise rejection:', e.reason);
        showToast('Beklenmeyen bir hata oluştu', 'error');
    });

    function updateRecentFileLastPage() {
        if (currentFileInfo && currentPage) {
            currentFileInfo.lastPage = currentPage;
            
            // Update in recent files list
            const fileIndex = recentFiles.findIndex(file => 
                file.name === currentFileInfo.name && file.url === currentFileInfo.url
            );
            
            if (fileIndex !== -1) {
                recentFiles[fileIndex].lastPage = currentPage;
                saveRecentFiles();
            }
        }
    }
</script>
</body>
</html>